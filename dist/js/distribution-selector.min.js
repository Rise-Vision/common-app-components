"use strict";angular.module("risevision.common.components.distribution-selector.services",["risevision.common.gapi"]),angular.module("risevision.common.components.distribution-selector",["risevision.common.components.distribution-selector.services","risevision.common.components.scrolling-list","risevision.common.loading","ui.bootstrap"]).value("CORE_URL","https://rvacore-test.appspot.com/_ah/api"),angular.module("risevision.common.components.distribution-selector.services").constant("DISPLAY_SEARCH_FIELDS",["name","id"]).service("displayService",["$q","$log","coreAPILoader","userState","DISPLAY_SEARCH_FIELDS",function(i,t,s,e,o){var r=function(i,t){var s="";for(var e in i)s+="OR "+i[e]+':~"'+t+'" ';return s=s.substring(3),s.trim()},l={list:function(l,n){var a=i.defer(),c=l.query?r(o,l.query):"",d={companyId:e.getSelectedCompanyId(),search:c,cursor:n,count:l.count,sort:l.sortBy+(l.reverse?" desc":" asc")};return t.debug("list displays called with",d),s().then(function(i){return i.display.list(d)}).then(function(i){a.resolve(i.result)}).then(null,function(i){t.error("Failed to get list of displays.",i),a.reject(i)}),a.promise}};return l}]),angular.module("risevision.common.components.distribution-selector").directive("distributionSelector",["$modal",function(i){return{restrict:"E",scope:{distribution:"=",distributeToAll:"="},templateUrl:"distribution-selector/distribution-selector.html",link:function(t){var s=function(){var i="0 Displays";return t.distributeToAll?i="All Displays":t.distribution&&(i=1===t.distribution.length?"1 Display":t.distribution.length+" Displays"),i};t.distributionSelectionMessage=s(),t.manage=function(){var e=i.open({templateUrl:"distribution-selector/distribution-modal.html",controller:"selectDistributionModal",size:"md",resolve:{distribution:function(){return t.distribution},distributeToAll:function(){return t.distributeToAll}}});e.result.then(function(i){t.distribution=i[0],t.distributeToAll=i[1],t.distributionSelectionMessage=s()})}}}}]),angular.module("risevision.common.components.distribution-selector").controller("distributionListController",["$scope","$rootScope","displayService","$loading","BaseList",function(i,t,s,e,o){var r=40;i.displays=new o(r),i.search={sortBy:"name",count:r,reverse:!1},i.filterConfig={placeholder:"Search Displays",id:"displaySearchInput"},i.$watch("loadingDisplays",function(i){i?e.start("display-list-loader"):e.stop("display-list-loader")}),i.load=function(){(!i.displays.list.length||!i.displays.endOfList&&i.displays.cursor)&&(i.loadingDisplays=!0,s.list(i.search,i.displays.cursor).then(function(t){i.displays.add(t.items?t.items:[],t.cursor)}).then(null,function(){i.error="Failed to load displays. Please try again later."}).finally(function(){i.loadingDisplays=!1}))},i.load(),i.sortBy=function(t){i.displays.clear(),t!==i.search.sortBy?i.search.sortBy=t:i.search.reverse=!i.search.reverse,i.load()},i.doSearch=function(){i.displays.clear(),i.load()},i.toggleDisplay=function(t){var s=i.parameters.distribution.indexOf(t);s>-1?i.parameters.distribution.splice(s,1):i.parameters.distribution.push(t)},i.cleanSelection=function(){i.parameters.distribution=[]},i.isSelected=function(t){var s=i.parameters.distribution.indexOf(t);return s>-1?!0:!1}}]),angular.module("risevision.common.components.distribution-selector").controller("selectDistributionModal",["$scope","$modalInstance","distribution","distributeToAll",function(i,t,s,e){i.parameters={},i.parameters.distribution=s?angular.copy(s):[],i.parameters.distributeToAll=e?e:!1,i.apply=function(){console.debug("Selected Distribution: ",i.parameters.distribution),console.debug("Selected Distribution distributeToAll: ",i.parameters.distributeToAll),t.close([i.parameters.distribution,i.parameters.distributeToAll])},i.dismiss=function(){t.dismiss()}}]),function(i){try{i=angular.module("risevision.common.components.distribution-selector")}catch(t){i=angular.module("risevision.common.components.distribution-selector",[])}i.run(["$templateCache",function(i){i.put("distribution-selector/distribution-list.html",'<div ng-controller="distributionListController"><div class="form-group"><label class="control-label"><input id="allDisplaysCheckbox" type="checkbox" ng-model="parameters.distributeToAll" class="add-right" ng-change="cleanSelection()"> All Displays</label></div><search-filter filter-config="filterConfig" search="search" do-search="doSearch"></search-filter><div class="content-box scrollable-list half-top" scrolling-list="load()" rv-spinner="" rv-spinner-key="display-list-loader" rv-spinner-start-active="1"><table id="displayListTable" class="table-2 table-hover" ng-class="{ \'animated fadeIn table-selector multiple-selector\': !parameters.distributeToAll}"><thead><tr><th id="tableHeaderName" ng-click="sortBy(\'name\')" class="clickable">Name<i ng-if="search.sortBy == \'name\'" class="fa" ng-class="{false: \'fa-long-arrow-up\', true: \'fa-long-arrow-down\'}[search.reverse]"></i></th><th id="tableHeaderAddress" class="text-right">Address</th></tr></thead><tbody><tr class="clickable-row display" ng-click="toggleDisplay(display.id);" ng-class="{\'active\' : isSelected(display.id) }" ng-repeat="display in displays.list"><td id="displayName-{{display.id}}" class="display-name">{{display.name}}</td><td id="displayAddress-{{display.id}}" class="display-address"><span class="text-muted">{{display.address}}</span></td></tr></tbody></table></div></div>')}])}(),function(i){try{i=angular.module("risevision.common.components.distribution-selector")}catch(t){i=angular.module("risevision.common.components.distribution-selector",[])}i.run(["$templateCache",function(i){i.put("distribution-selector/distribution-modal.html",'<div id="distributionModal"><div class="modal-header"><button type="button" class="close" ng-click="dismiss()" aria-hidden="true"><i class="fa fa-times"></i></button><h3 class="modal-title">Edit Distribution</h3></div><div class="modal-body" ng-include="" src="\'distribution-selector/distribution-list.html\'"></div><div class="modal-footer"><button id="applyButton" class="btn-primary btn" ng-click="apply()">Apply <i class="fa fa-check icon-right"></i></button> <button id="distributionModalCancelButton" class="btn btn-default" ng-click="dismiss()">Cancel <i class="fa fa-times icon-right"></i></button></div></div>')}])}(),function(i){try{i=angular.module("risevision.common.components.distribution-selector")}catch(t){i=angular.module("risevision.common.components.distribution-selector",[])}i.run(["$templateCache",function(i){i.put("distribution-selector/distribution-selector.html",'<label class="control-label">Distribution</label><div id="distributionField" class="content-box-editable remove-bottom clickable" ng-click="manage()"><div class="label label-tag"><span id="distributionFieldText" ng-bind="distributionSelectionMessage"></span></div></div>')}])}();