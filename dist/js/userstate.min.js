!function(e){"use strict";try{e.module("risevision.common.config")}catch(t){e.module("risevision.common.config",[])}e.module("risevision.common.config").value("ENABLE_EXTERNAL_LOGGING",!0).value("CORE_URL","https://rvaserver2.appspot.com/_ah/api"),e.module("risevision.common.components.util",[]),e.module("risevision.common.components.logging",[]),e.module("risevision.common.components.rvtokenstore",["risevision.common.components.util","LocalStorageModule","ngBiscuit"]),e.module("risevision.common.components.userstate",["ui.router","angular-md5","risevision.common.components.util","risevision.common.components.rvtokenstore","risevision.common.components.logging","risevision.common.config","risevision.common.gapi","LocalStorageModule","risevision.core.cache","risevision.core.oauth2","risevision.core.company","risevision.core.util","risevision.core.userprofile","risevision.common.loading","risevision.ui-flow"]).config(["$urlRouterProvider","$stateProvider","$locationProvider",function(e,t,o){o.html5Mode(!0),e.otherwise("/"),t.state("common",{template:"<div ui-view></div>"}).state("common.googleresult",{url:"/state=:state&access_token=:access_token&token_type=:token_type&expires_in=:expires_in",controller:"GoogleResultCtrl"}).state("common.auth",{"abstract":!0,template:'<div class="app-launcher" ui-view></div>'}).state("common.auth.unauthorized",{controller:"UrlStateCtrl",template:"<div ui-view></div>"}).state("common.auth.unauthorized.final",{templateProvider:["$templateCache",function(e){return e.get("userstate/login.html")}],url:"/unauthorized/:state",controller:"LoginCtrl",params:{passwordReset:null,accountConfirmed:null},resolve:{isSignUp:function(){return!1}}}).state("common.auth.createaccount",{controller:"UrlStateCtrl",template:"<div ui-view></div>"}).state("common.auth.createaccount.final",{templateProvider:["$templateCache",function(e){return e.get("userstate/create-account.html")}],url:"/createaccount/:state",controller:"LoginCtrl",resolve:{isSignUp:function(){return!0}}}).state("common.auth.confirmaccount",{controller:"ConfirmAccountCtrl",template:"<div ui-view></div>",url:"/confirmaccount/:user/:token"}).state("common.auth.requestpasswordreset",{templateProvider:["$templateCache",function(e){return e.get("userstate/request-password-reset.html")}],url:"/requestpasswordreset",controller:"RequestPasswordResetCtrl"}).state("common.auth.resetpassword",{templateProvider:["$templateCache",function(e){return e.get("userstate/reset-password-confirm.html")}],url:"/resetpassword/:user/:token",controller:"ResetPasswordConfirmCtrl"})}]).run(["$rootScope","$state","$stateParams","urlStateService",function(e,t,o,n){e.$on("risevision.user.signedOut",function(){t.go("common.auth.unauthorized")}),e.$on("risevision.user.authorized",function(){o.state&&-1!==t.current.name.indexOf("common.auth")&&n.redirectToState(o.state)})}]).value("CLIENT_ID","614513768474.apps.googleusercontent.com")}(angular),angular.module("risevision.common.components.userstate").factory("canAccessApps",["$q","$state","$location","userState","userAuthFactory",function(e,t,o,n,s){return function(){return s.authenticate(!1).catch(function(){return t.go("common.auth.createaccount",null,{reload:!0}),o.replace(),e.reject()})}}]),angular.module("risevision.common.components.logging").factory("bigQueryLogging",["externalLogging","userState",function(e,t){var o={};return o.logEvent=function(o,n,s,r,a){return e.logEvent(o,n,s,r||t.getUsername(),a||t.getSelectedCompanyId())},o}]),function(e){"use strict";e.module("risevision.common.components.userstate").factory("companyState",["$location","getCompany","objectHelper","$rootScope","$log","$q",function(t,o,n,s,r,a){var i,c={userCompany:{},selectedCompany:{}},u=function(){n.clearObj(c.selectedCompany),n.clearObj(c.userCompany),r.debug("Company state has been reset.")};t.search().cid&&(r.debug("cid",t.search().cid,"saved for later processing."),i=t.search().cid);var l=function(){var e=a.defer();return o().then(function(e){var t=m.getSelectedCompanyId()?m.getSelectedCompanyId():i;return n.clearAndCopy(e,c.userCompany),d(t)}).then(null,function(){m.resetCompany()}).finally(function(){i=null,e.resolve(null)}),e.promise},d=function(e){var t=a.defer();return e&&e!==c.userCompany.id?o(e).then(function(e){n.clearAndCopy(e,c.selectedCompany),t.resolve(),s.$broadcast("risevision.company.selectedCompanyChanged")}).then(null,function(e){console.error("Failed to load selected company.",e),t.reject(e)}):(m.resetCompany(),t.resolve()),t.promise},m={init:l,switchCompany:d,updateCompanySettings:function(e){e&&e.id===m.getSelectedCompanyId()&&n.clearAndCopy(e,c.selectedCompany),e&&e.id===m.getUserCompanyId()&&n.clearAndCopy(e,c.userCompany),s.$broadcast("risevision.company.updated",{companyId:e.id})},resetCompany:function(){n.clearAndCopy(c.userCompany,c.selectedCompany),s.$broadcast("risevision.company.selectedCompanyChanged")},resetCompanyState:u,getUserCompanyId:function(){return c.userCompany&&c.userCompany.id||null},getUserCompanyName:function(){return c.userCompany&&c.userCompany.name||null},getSelectedCompanyId:function(){return c.selectedCompany&&c.selectedCompany.id||null},getSelectedCompanyName:function(){return c.selectedCompany&&c.selectedCompany.name||null},getSelectedCompanyCountry:function(){return c.selectedCompany&&c.selectedCompany.country||null},getCopyOfUserCompany:function(t){return t?e.extend({},c.userCompany):n.follow(c.userCompany)},getCopyOfSelectedCompany:function(t){return t?e.extend({},c.selectedCompany):n.follow(c.selectedCompany)},isSubcompanySelected:function(){return c.selectedCompany&&c.selectedCompany.id!==(c.userCompany&&c.userCompany.id)},isTestCompanySelected:function(){return c.selectedCompany&&c.selectedCompany.isTest===!0},isSeller:function(){return c.selectedCompany&&c.selectedCompany.sellerId?!0:!1},isRootCompany:function(){return c.userCompany&&!c.userCompany.parentId}};return m}])}(angular),function(e){"use strict";e.module("risevision.common.components.userstate").factory("customAuthFactory",["$q","$log","gapiLoader","userauth","userState",function(e,t,o,n,s){var r={};return r.authenticate=function(t){var r=e.defer(),a=s._state;return t&&t.username&&t.password?e.all([o(),n.login(t.username,t.password)]).then(function(e){var o=e[0],n=e[1]&&e[1].result;if(n&&n.item){var s={access_token:n.item,expires_in:"3600",token_type:"Bearer"};o.auth.setToken(s),r.resolve({email:t.username,token:s})}else r.reject()}).then(null,function(){r.reject()}):a.userToken&&a.userToken.token?o().then(function(e){e.auth.setToken(a.userToken.token),r.resolve(a.userToken)}):r.reject(),r.promise},r.addUser=function(t){var o=e.defer();return t&&t.username&&t.password?n.add(t.username,t.password).then(function(){o.resolve()}).then(null,function(){o.reject()}):o.reject(),o.promise},r}])}(angular),angular.module("risevision.common.components.logging").constant("EXTERNAL_LOGGER_SERVICE_URL","https://www.googleapis.com/bigquery/v2/projects/client-side-events/datasets/Apps_Events/tables/TABLE_ID/insertAll").constant("EXTERNAL_LOGGER_REFRESH_URL","https://www.googleapis.com/oauth2/v3/token?client_id=1088527147109-6q1o2vtihn34292pjt4ckhmhck0rk0o7.apps.googleusercontent.com&client_secret=nlZyrcPLg6oEwO9f9Wfn29Wh&refresh_token=1/xzt4kwzE1H7W9VnKB8cAaCx6zb4Es4nKEoqaYHdTD15IgOrJDtdun6zK6XiATCKT&grant_type=refresh_token").factory("externalLogging",["$http","$window","$q","$log","EXTERNAL_LOGGER_REFRESH_URL","EXTERNAL_LOGGER_SERVICE_URL","ENABLE_EXTERNAL_LOGGING",function(e,t,o,n,s,r,a){var i,c,u={},l=function(){var e=new Date,t=e.getUTCFullYear(),o=e.getUTCMonth()+1,n=e.getUTCDate();return 10>o&&(o="0"+o),10>n&&(n="0"+n),t.toString()+o.toString()+n.toString()},d={kind:"bigquery#tableDataInsertAllRequest",skipInvalidRows:!1,ignoreUnknownValues:!1,templateSuffix:l(),rows:[{insertId:"",json:{event:"",event_details:"",event_value:0,host:"",ts:0,user_id:"",company_id:""}}]};return u.logEvent=function(s,i,c,l,m){if(n.debug("BQ log",s,i,c,l,m),a===!1)return n.debug("External Logging DISABLED"),void 0;var p=o.defer();return u.getToken().then(function(o){var a=JSON.parse(JSON.stringify(d)),u=r.replace("TABLE_ID","apps_events");a.rows[0].insertId=Math.random().toString(36).substr(2).toUpperCase(),a.rows[0].json.event=s,i&&(a.rows[0].json.event_details=i),c&&(a.rows[0].json.event_value=c),a.rows[0].json.user_id=l||"",a.rows[0].json.company_id=m||"",a.rows[0].json.host=t.location.hostname,a.rows[0].json.ts=(new Date).toISOString(),e.post(u,a,{headers:{"Content-Type":"application/json",Authorization:"Bearer "+o}}).then(function(e){p.resolve(e)},function(e){n.debug("error posting to BQ",e),p.reject(e)})},function(e){n.debug("BQ token ERROR",e),p.reject(e)}),p.promise},u.getToken=function(){var t=o.defer();return i&&(new Date).getTime()-c<358e4?t.resolve(i):e.post(s).then(function(e){i=e.data.access_token,c=(new Date).getTime(),t.resolve(e.data.access_token)},function(){t.reject()}),t.promise},u}]),function(e){"use strict";e.module("risevision.common.components.userstate").value("OAUTH2_SCOPES","https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/userinfo.profile").value("GOOGLE_OAUTH2_URL","https://accounts.google.com/o/oauth2/auth").factory("googleAuthFactory",["$q","$log","$location","$interval","$window","$http","$stateParams","gapiLoader","getOAuthUserInfo","uiFlowManager","getBaseDomain","userState","CLIENT_ID","OAUTH2_SCOPES","GOOGLE_OAUTH2_URL",function(e,t,o,n,s,r,a,i,c,u,l,d,m,p,g){var f=null,v=function(){n.cancel(f),f=n(function(){n.cancel(f),w()},33e5)},h=function(n){var s=e.defer(),a=d._state,c={client_id:m,scope:p,cookie_policy:o.protocol()+"://"+l()};return c.authuser="dummy"!==a.userToken?a.userToken.email:r.get("https://www.googleapis.com/oauth2/v1/userinfo?access_token="+a.params.access_token).then(function(e){return e.data.email},function(){return t.debug("Error retrieving userinfo"),c.authuser}),n?c.immediate=!0:c.prompt="select_account",e.all([i(),c.authuser]).then(function(e){var t=e[0];return c.authuser=e[1],t.auth.setToken(a.params),t.auth.authorize(c)}).then(function(e){t.debug("authResult"),e&&!e.error?(a.params&&delete a.params,v(),s.resolve(e)):s.reject(e.error||"failed to authorize user")}).then(null,s.reject),s.promise},w=function(t){var o,n=e.defer();return h(!t).then(function(e){return o=e,c()}).then(function(e){n.resolve(e)}).then(null,function(e){n.reject(e)}),n.promise},y=function(t){if(t){var o,n;return o=s.location.origin+"/",n=encodeURIComponent(a.state),d._persistState(),u.persist(),s.location.href=g+"?response_type=token&scope="+encodeURIComponent(p)+"&client_id="+m+"&redirect_uri="+encodeURIComponent(o)+"&prompt=select_account&state="+n,e.resolve()}return w(t)},b={authenticate:d._state.inRVAFrame?w:y};return b}])}(angular),function(e){"use strict";e.module("risevision.common.components.rvtokenstore").service("rvTokenStore",["$log","$location","cookieStore","getBaseDomain",function(e,t,o,n){var s=function(){var e=o.get("rv-token");try{return JSON.parse(e)}catch(t){return e}},r=function(e){var t=n();"localhost"===t?o.put("rv-token",JSON.stringify(e),{path:"/"}):o.put("rv-token",JSON.stringify(e),{domain:t,path:"/"})},a=function(){var e=n();"localhost"===e?o.remove("rv-token",{path:"/"}):o.remove("rv-token",{domain:e,path:"/"})},i={read:s,write:r,clear:a};return i}])}(angular),function(e){"use strict";e.module("risevision.common.components.userstate").run(["$rootScope","userState","selectedCompanyUrlHandler",function(e,t,o){e.$on("risevision.company.selectedCompanyChanged",function(e){e&&o.updateUrl()}),e.$on("$stateChangeSuccess",o.updateSelectedCompanyFromUrl),e.$on("$routeChangeSuccess",o.updateSelectedCompanyFromUrl),e.$on("$locationChangeSuccess",o.locationChangeSuccess)}]).service("selectedCompanyUrlHandler",["$state","$stateParams","$location","userState",function(e,t,o,n){this.updateUrl=function(){var s=n.getSelectedCompanyId();s&&o.search().cid!==s&&!e.transition&&(t.cid=s,e.params.cid=s,o.search("cid",s))},this.updateSelectedCompanyFromUrl=function(){var s=o.search().cid;if(s&&n.getUserCompanyId()&&s!==n.getSelectedCompanyId())n.switchCompany(s);else if(!s&&n.getSelectedCompanyId()){var r=o.absUrl();t.cid=n.getSelectedCompanyId(),e.params.cid=n.getSelectedCompanyId(),o.search("cid",n.getSelectedCompanyId()),r===o.destUrl&&o.replace()}},this.locationChangeSuccess=function(e,t){o.destUrl=t}}])}(angular),function(e){"use strict";e.module("risevision.common.components.userstate").factory("urlStateService",["$window","$location","userState",function(e,t,o){var n={};return n.get=function(){var t,o,n;return t=e.location.pathname?e.location.pathname.substring(1):"",o=e.location.search,n=encodeURIComponent(JSON.stringify({p:t,u:e.location.hash,s:o}))},n.redirectToState=function(n){var s={};try{s=JSON.parse(decodeURIComponent(n))}catch(r){}s.u||!t.$$html5?s.p||s.s?(o._persistState(),e.location.replace(s.p+s.s+s.u)):e.location.hash=s.u:(s.p=s.p||"/",t.url(s.p+s.s),t.replace())},n}])}(angular),function(e){"use strict";e.module("risevision.common.components.userstate").factory("userAuthFactory",["$q","$log","$location","$rootScope","$loading","$window","$document","gapiLoader","objectHelper","rvTokenStore","externalLogging","userState","googleAuthFactory","customAuthFactory",function(t,o,n,s,r,a,i,c,u,l,d,m,p,g){var f,v,h=m._state,w=!0,y=function(e){if(w){w=!1;try{var t=(new Date).getTime()-a.performance.timing.navigationStart;d.logEvent("page load time",e,t,m.getUsername(),m.getSelectedCompanyId())}catch(n){o.debug("Error logging load time")}}},b=function(e){h.userToken=e,l.write(h.userToken)},C=function(){},S=function(){o.debug("Clearing user token..."),C(),h.userToken=null,l.clear()},R=function(){var t=l.read();e.equals(t,h.userToken)?h.userToken&&(v=null,E(!1).finally(function(){h.userToken||(o.debug("Authentication failed. Reloading..."),a.location.reload())})):a.location.reload()},_=function(){var e,t=i[0];"undefined"!=typeof t.hidden?e="visibilityState":"undefined"!=typeof t.mozHidden?e="mozVisibilityState":"undefined"!=typeof t.msHidden?e="msVisibilityState":"undefined"!=typeof t.webkitHidden&&(e="webkitVisibilityState"),o.debug("visibility: "+t[e]),"visible"===t[e]&&R()},$=function(){var e,t=i[0];return"undefined"!=typeof t.hidden?e="visibilitychange":"undefined"!=typeof t.mozHidden?e="mozvisibilitychange":"undefined"!=typeof t.msHidden?e="msvisibilitychange":"undefined"!=typeof t.webkitHidden&&(e="webkitvisibilitychange"),e},k=function(){document.addEventListener($(),_)},P=function(){document.removeEventListener($(),_)};k();var U=function(e){var o=!1;return f?f.promise:e?h.user.username&&h.profile.username&&h.user.username===e.email?t.resolve():(f=t.defer(),u.clearAndCopy({userId:e.id,username:e.email,picture:e.picture},h.user),b(e),m.refreshProfile().finally(function(){f.resolve(),s.$broadcast("risevision.user.authorized"),o||s.$broadcast("risevision.user.userSignedIn"),f=void 0}),f.promise):(u.clearObj(h.user),t.reject("No user"))},E=function(n,s){var a,i=!1;if(n&&(v=null,m._resetState()),v)return v.promise;v=t.defer(),a=v,o.debug("authentication called");var l=function(){var t=e.isDefined(h.userToken)&&null!==h.userToken;if(o.debug("userAuthed",t),n||t===!0){var c;s||h.userToken&&h.userToken.token?(i=!0,c=g.authenticate(s)):c=p.authenticate(n),c.then(U).then(function(){m._setIsRiseAuthUser(i),a.resolve()}).then(null,function(e){S(),o.debug("Authentication Error: "+e),a.reject(e)}).finally(function(){r.stopGlobal("risevision.user.authenticate"),y("authenticated user")})}else{var l="user is not authenticated";o.debug(l),a.reject(l),u.clearObj(h.user),r.stopGlobal("risevision.user.authenticate"),y("unauthenticated user")}};return c().finally(l),n&&r.startGlobal("risevision.user.authenticate"),a.promise},A=function(e){return c().then(function(t){m.isRiseAuthUser()||(e&&(a.logoutFrame.location="https://accounts.google.com/Logout"),t.auth.signOut()),v=null,S(),m._resetState(),s.$broadcast("risevision.user.signedOut"),o.debug("User is signed out.")})},T=function(e){return"string"==typeof e&&e.trim().length>=4},I={authenticate:E,authenticatePopup:function(){return E(!0)},signOut:A,isPasswordValid:T,addEventListenerVisibilityAPI:k,removeEventListenerVisibilityAPI:P};return I}])}(angular),function(){"use strict";angular.module("risevision.common.components.userstate").service("userauth",["$q","$log","riseAPILoader",function(e,t,o){var n={add:function(n,s){var r=e.defer(),a={username:n,password:s};return o().then(function(e){return e.userauth.add(a)}).then(function(e){t.debug("added user credentials",e),r.resolve(e.result)}).then(null,function(e){console.error("Failed to add credentials.",e),r.reject(e)}),r.promise},updatePassword:function(n,s,r){var a=e.defer(),i={username:n,oldPassword:s,newPassword:r};return o().then(function(e){return e.userauth.updatePassword(i)}).then(function(e){t.debug("update user credentials resp",e),a.resolve(e.result)}).then(null,function(e){console.error("Failed to update credentials.",e),a.reject(e)}),a.promise},login:function(n,s){var r=e.defer(),a={username:n,password:s};return o().then(function(e){return e.userauth.login(a)}).then(function(e){t.debug("login successful",e),r.resolve(e)}).then(null,function(e){console.error("Failed to login user.",e),r.reject(e)}),r.promise},refreshToken:function(n,s){var r=e.defer(),a={username:n,token:s};return o().then(function(e){return e.userauth.refreshToken(a)}).then(function(e){t.debug("token refresh successful",e),r.resolve(e)}).then(null,function(e){console.error("Failed to refresh token.",e),r.reject(e)}),r.promise},confirmUserCreation:function(n,s){var r=e.defer(),a={username:n,userConfirmedToken:s};return o().then(function(e){return e.userauth.confirmUserCreation(a)}).then(function(e){t.debug("Confirm user creation successful",e),r.resolve(e)}).then(null,function(e){console.error("Failed to confirm user creation.",e),r.reject(e)}),r.promise},requestConfirmationEmail:function(n){var s=e.defer(),r={username:n};return o().then(function(e){return e.userauth.requestConfirmationEmail(r)}).then(function(e){t.debug("Request confirmation email successful",e),s.resolve(e)}).then(null,function(e){console.error("Failed to request confirmation email.",e),s.reject(e)}),s.promise},requestPasswordReset:function(n){var s=e.defer(),r={username:n};return o().then(function(e){return e.userauth.requestPasswordReset(r)}).then(function(e){t.debug("Request password reset successful",e),s.resolve(e)}).then(null,function(e){console.error("Failed to request password reset.",e),s.reject(e)}),s.promise},resetPassword:function(n,s,r){var a=e.defer(),i={username:n,passwordResetToken:s,newPassword:r};return o().then(function(e){return e.userauth.resetPassword(i)}).then(function(e){t.debug("Reset password successful",e),a.resolve(e)}).then(null,function(e){console.error("Failed to reset password.",e),a.reject(e)}),a.promise}};return n}])}(),function(e){"use strict";e.module("risevision.common.components.userstate").value("PROFILE_PICTURE_URL","https://www.gravatar.com/avatar/{emailMD5}?d=mm").factory("userState",["$q","$rootScope","$window","$log","$location","userInfoCache","getUserProfile","companyState","objectHelper","localStorageService","rvTokenStore","md5","PROFILE_PICTURE_URL",function(t,o,n,s,r,a,i,c,u,l,d,m,p){var g={profile:{},user:{},roleMap:{},userToken:d.read(),inRVAFrame:e.isDefined(r.search().inRVA),isRiseAuthUser:!1},f=function(){var e=t.defer();return i(g.user.username,!0).then(function(e){return R.updateUserProfile(e),c.init()}).then(function(){o.$broadcast("risevision.profile.refreshed"),e.resolve()},e.reject),e.promise},v=function(){return g.user.username?!0:!1},h=function(){return null!==g.profile.username&&void 0!==g.profile.username},w=function(t){return e.isDefined(g.roleMap[t])},y=function(){return n.gapi?n.gapi.auth.getToken():null},b=function(){var t=l.get("risevision.common.userState");t&&(e.extend(g,t),l.remove("risevision.common.userState"),s.debug("userState restored with",t))},C=function(){a.removeAll(),u.clearObj(g.user),u.clearObj(g.profile),g.roleMap={},c.resetCompanyState(),s.debug("User state has been reset.")},S=function(){var e=R.getUsername()&&m.createHash(R.getUsername()),t=e||"0";return p.replace("{emailMD5}",t)},R={getUsername:function(){return g.user&&g.user.username||null},getUserEmail:function(){return g.profile.email},getCopyOfProfile:function(t){return t?e.extend({},g.profile):u.follow(g.profile)},getUserPicture:function(){return g.user.picture||S()},hasRole:w,inRVAFrame:function(){return g.inRVAFrame},isRiseAdmin:function(){return w("sa")&&c.isRootCompany()},isRiseStoreAdmin:function(){return w("ba")&&c.isRootCompany()},isUserAdmin:function(){return w("ua")},isPurchaser:function(){return w("pu")},isRiseAuthUser:function(){return g.isRiseAuthUser},isSeller:c.isSeller,isRiseVisionUser:h,isLoggedIn:v,getAccessToken:y,checkUsername:function(e){return!(!e||!R.getUsername()||e.toUpperCase()!==R.getUsername().toUpperCase())},updateUserProfile:function(t){R.checkUsername(t.username)&&(u.clearAndCopy(e.extend({username:g.user.username},t),g.profile),g.roleMap={},g.profile.roles&&g.profile.roles.forEach(function(e){g.roleMap[e]=!0}),o.$broadcast("risevision.user.updated"))},refreshProfile:f,getUserCompanyId:c.getUserCompanyId,getUserCompanyName:c.getUserCompanyName,getSelectedCompanyId:c.getSelectedCompanyId,getSelectedCompanyName:c.getSelectedCompanyName,getSelectedCompanyCountry:c.getSelectedCompanyCountry,getCopyOfUserCompany:c.getCopyOfUserCompany,getCopyOfSelectedCompany:c.getCopyOfSelectedCompany,isSubcompanySelected:c.isSubcompanySelected,isTestCompanySelected:c.isTestCompanySelected,isRootCompany:c.isRootCompany,updateCompanySettings:c.updateCompanySettings,updateUserCompanySettings:c.updateUserCompanySettings,resetCompany:c.resetCompany,switchCompany:c.switchCompany,_restoreState:b,_resetState:C,_setUserToken:function(e){g.params=e,g.userToken="dummy"},_persistState:function(){l.set("risevision.common.userState",g)},_state:g,_setIsRiseAuthUser:function(e){g.isRiseAuthUser=e}};return R}])}(angular),function(e){"use strict";e.module("risevision.common.components.util").value("humanReadableError",function(e){var t;return t=e.message?e.message:e.error?e.error.message?e.error.message:e.error:e,JSON.stringify(t)}).factory("dateIsInRange",[function(){return function(e,t,o){var n,s,r=!0;try{t&&(n=t.match(/(\d{4})\-(\d{2})\-(\d{2})/),s=new Date(n[1],parseInt(n[2])-1,n[3],0,0,0,0),r=e>=s),r&&o&&(n=o.match(/(\d{4})\-(\d{2})\-(\d{2})/),s=new Date(n[1],parseInt(n[2])-1,n[3],0,0,0,0),r=s>=e)}catch(a){r=!1}return r}}]).factory("objectHelper",[function(){var t={};return t.follow=function(e){var t=function(){};return t.prototype=e,new t},t.clearObj=function(e){for(var t in e)delete e[t]},t.clearAndCopy=function(o,n){t.clearObj(n),e.extend(n,o)},t}]).factory("getBaseDomain",["$log","$location",function(e,t){var o=function(e){return/^([0-9])+\.([0-9])+\.([0-9])+\.([0-9])+$/.test(e)?!0:!1};return function(){var n;if(!n){var s=t.host();if(o(s))n=s;else{var r=s.split(".");n=r.length>1?"appspot"===r[r.length-2]?r.slice(r.length-3).join("."):r.slice(r.length-2).join("."):s}e.debug("baseDomain",n)}return n}}])}(angular),angular.module("risevision.common.components.userstate").controller("ConfirmAccountCtrl",["$scope","$loading","$log","$state","$stateParams","userauth",function(e,t,o,n,s,r){t.startGlobal("auth-confirm-account"),r.confirmUserCreation(s.user,s.token).then(function(){o.log("User confirmed")}).catch(function(e){o.error(e)}).finally(function(){t.stopGlobal("auth-confirm-account"),n.go("common.auth.unauthorized.final",{accountConfirmed:!0})})}]),angular.module("risevision.common.components.userstate").controller("GoogleResultCtrl",["$log","$stateParams","userState","urlStateService",function(e,t,o,n){e.debug("URL params",t),o._restoreState(),t.access_token&&o._setUserToken(t),t.state&&n.redirectToState(t.state)}]),angular.module("risevision.common.components.userstate").controller("LoginCtrl",["$scope","$loading","$stateParams","$state","userAuthFactory","customAuthFactory","uiFlowManager","urlStateService","userState","$window","isSignUp",function(e,t,o,n,s,r,a,i,c,u,l){e.forms={},e.credentials={},e.messages={},e.errors={},e.isSignUp=l,e.messages.passwordReset=o.passwordReset,e.messages.accountConfirmed=o.accountConfirmed,e.googleLogin=function(e){t.startGlobal("auth-buttons-login"),s.authenticate(!0).finally(function(){t.stopGlobal("auth-buttons-login"),a.invalidateStatus(e)})},e.customLogin=function(n){e.errors={},e.forms.loginForm.$valid&&(t.startGlobal("auth-buttons-login"),s.authenticate(!0,e.credentials).then(function(){i.redirectToState(o.state),c.isRiseVisionUser()||u.location.reload()}).then(null,function(){e.errors.loginError=!0}).finally(function(){t.stopGlobal("auth-buttons-login"),a.invalidateStatus(n)}))},e.isPasswordValid=function(){return s.isPasswordValid(e.credentials.password)},e.showSignUp=function(){i.get();n.go("common.auth.createaccount.final",{state:o.state})},e.showSignIn=function(){i.get();n.go("common.auth.unauthorized.final",{state:o.state})},e.createAccount=function(o){e.errors={},e.forms.loginForm.$valid&&e.isPasswordValid()&&(t.startGlobal("auth-buttons-login"),r.addUser(e.credentials).then(function(){e.errors.confirmationRequired=!0}).then(null,function(){e.errors.duplicateError=!0}).finally(function(){t.stopGlobal("auth-buttons-login"),a.invalidateStatus(o)}))}}]),angular.module("risevision.common.components.userstate").controller("RequestPasswordResetCtrl",["$scope","$loading","$log","userauth",function(e,t,o,n){e.forms={},e.credentials={},e.errors={},e.emailSent=!1,e.requestPasswordReset=function(){e.emailSent=!1,t.startGlobal("auth-request-password-reset"),n.requestPasswordReset(e.credentials.username).then(function(){o.log("Reset password request sent")}).catch(function(e){o.error(e)}).finally(function(){t.stopGlobal("auth-request-password-reset"),e.emailSent=!0})}}]),angular.module("risevision.common.components.userstate").controller("ResetPasswordConfirmCtrl",["$scope","$loading","$log","$state","$stateParams","userauth","userAuthFactory",function(e,t,o,n,s,r,a){function i(){e.emailResetSent=!1,e.invalidToken=!1,e.invalidPassword=!1,e.notMatchingPassword=!1}e.forms={},e.credentials={},e.errors={},e.resetPassword=function(){return i(),a.isPasswordValid(e.credentials.newPassword)?e.credentials.newPassword!==e.credentials.confirmPassword?(e.notMatchingPassword=!0,void 0):(t.startGlobal("auth-reset-password"),r.resetPassword(s.user,s.token,e.credentials.newPassword).then(function(){o.log("Password updated"),n.go("common.auth.unauthorized.final",{passwordReset:!0})}).catch(function(t){var n=t.result&&t.result.error&&t.result.error.message;"Password reset token does not match"===n?e.invalidToken=!0:o.error(t)}).finally(function(){t.stopGlobal("auth-reset-password")}),void 0):(e.invalidPassword=!0,void 0)},e.requestPasswordReset=function(){i(),t.startGlobal("auth-request-password-reset"),r.requestPasswordReset(s.user).then(function(){o.log("Email sent"),e.emailResetSent=!0}).catch(function(e){o.error(e)}).finally(function(){t.stopGlobal("auth-request-password-reset")})}}]),angular.module("risevision.common.components.userstate").controller("UrlStateCtrl",["$state","urlStateService",function(e,t){if(-1===e.current.name.indexOf(".final")){var o=t.get(),n=e.current.name+".final";e.go(n,{state:o})}}]),function(e){try{e=angular.module("risevision.common.components.userstate")}catch(t){e=angular.module("risevision.common.components.userstate",[])}e.run(["$templateCache",function(e){e.put("userstate/auth-form.html",'<form id="forms.loginForm" name="forms.loginForm" role="form" novalidate=""><div><div class="panel-body bg-danger u_margin-sm-top" ng-show="errors.duplicateError"><p class="u_remove-bottom"><i class="fa fa-warning icon-left"></i> <span>This email address is already registered. You can <a href="#" ng-click="showSignIn()">sign in</a>with this address.</span></p></div><div class="panel-body bg-danger u_margin-sm-top" ng-show="errors.loginError"><p class="u_remove-bottom"><i class="fa fa-warning icon-left"></i> <span>Your email address/password combination is incorrect.</span></p></div><div class="panel-body bg-danger u_margin-sm-top" ng-show="errors.unconfirmedError"><p class="u_remove-bottom"><i class="fa fa-warning icon-left"></i> <span>Your email address has not been confirmed.<br><a href="#">Resend Email Confirmation</a></span></p></div><div class="panel-body bg-info u_margin-sm-top" ng-show="errors.confirmationRequired"><p class="u_remove-bottom"><i class="fa fa-warning icon-left"></i> <span>We\'ve sent a confirmation email to {{credentials.username}}.<br>Please check your inbox to complete your account registration.</span></p></div><div class="panel-body bg-info u_margin-sm-top" ng-show="messages.passwordReset"><p class="u_remove-bottom"><i class="fa fa-warning icon-left"></i> <span>Password successfully updated.<br>Please sign in to proceed.</span></p></div><div class="panel-body bg-info u_margin-sm-top" ng-show="messages.accountConfirmed"><p class="u_remove-bottom"><i class="fa fa-warning icon-left"></i> <span>Account successfully confirmed.<br>Please sign in to proceed.</span></p></div></div><div class="u_margin-sm-top" ng-show="!errors.confirmationRequired"><div class="form-group" ng-class="{\'has-error\': (forms.loginForm.$submitted && forms.loginForm.username.$invalid)}" show-errors=""><label class="control-label">Email</label> <input type="email" class="form-control" placeholder="Enter Username" id="username" name="username" ng-model="credentials.username" required="" focus-me="true"><p class="text-danger" ng-show="forms.loginForm.$submitted && forms.loginForm.username.$invalid">Please enter an Email</p></div><div class="form-group" ng-class="{\'has-error\': (forms.loginForm.$submitted && !isPasswordValid() && isSignUp), \'has-message\': isPasswordValid() && isSignUp}" show-errors=""><label class="control-label">Password</label> <input type="password" class="form-control" placeholder="Enter Password" id="password" name="password" ng-model="credentials.password" required=""><p class="text-danger" ng-show="forms.loginForm.$submitted && !isPasswordValid() && isSignUp">Please enter at least 4 characters.</p><p class="text-warning" ng-show="isPasswordValid() && isSignUp">A strong password is at least 8 characters, includes uppercase/lowercase letters, and one or more numbers.</p></div></div></form>')}])}(),function(e){try{e=angular.module("risevision.common.components.userstate")}catch(t){e=angular.module("risevision.common.components.userstate",[])}e.run(["$templateCache",function(e){e.put("userstate/create-account.html",'<div class="app-launcher-login"><div class="container"><div class="panel"><div class="row"><div class="col-sm-6 col-xs-12"><div class="rise-logo"><img src="https://s3.amazonaws.com/Rise-Images/Website/rise-logo.svg"></div></div><div class="col-sm-6 col-xs-12"><h1 class="u_remove-top">Get Started For Free</h1><p class="lead text-muted">No commitments or contracts</p><div class="col-xs-12 col-md-8" ng-show="!errors.confirmationRequired"><button class="btn btn-google-auth btn-hg" ng-click="googleLogin(\'registrationComplete\')"><span><img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg"> Sign up with Google</span></button></div><div class="section-divider col-xs-12 col-md-8 u_margin-md-top" ng-show="!errors.confirmationRequired"><div></div><span>OR</span><div></div></div><div class="col-md-8 col-xs-12"><div ng-include="\'userstate/auth-form.html\'"></div><div class="form-group" ng-show="!errors.confirmationRequired"><button class="btn btn-primary btn-hg" type="submit" form="forms.loginForm" ng-click="createAccount(\'registrationComplete\')"><span translate="Sign Up"></span></button></div></div><br><div class="col-xs-12 u_margin-lg-top"><p class="text-muted">Already have an account? <a id="sign-in-link" href="#" ng-click="showSignIn()">Sign in</a></p></div></div></div></div></div></div>')
}])}(),function(e){try{e=angular.module("risevision.common.components.userstate")}catch(t){e=angular.module("risevision.common.components.userstate",[])}e.run(["$templateCache",function(e){e.put("userstate/login.html",'<div class="app-launcher-login"><div class="container"><div class="panel"><div class="row"><div class="col-sm-6 col-xs-12"><div class="rise-logo"><img src="https://s3.amazonaws.com/Rise-Images/Website/rise-logo.svg"></div></div><div class="col-sm-6 col-xs-12"><h1 class="u_remove-top">Sign In</h1><p class="lead text-muted">to your Rise Vision account</p><div class="col-xs-12 col-md-8"><button class="btn btn-google-auth btn-hg" ng-click="googleLogin(\'registrationComplete\')"><span><img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg"> Sign in with Google</span></button></div><div class="section-divider col-xs-12 col-md-8 u_margin-md-top"><div></div><span>OR</span><div></div></div><div class="col-md-8 col-xs-12"><div ng-include="\'userstate/auth-form.html\'"></div><div class="form-group"><button class="btn btn-primary btn-hg" type="submit" form="forms.loginForm" ng-click="customLogin(\'registrationComplete\')"><span translate="Sign In"></span></button></div></div><br><div class="col-xs-12 u_margin-lg-top"><p class="text-muted"><a id="sign-in-link" href="#" ui-sref="common.auth.requestpasswordreset">Forgot your password?</a></p><p class="text-muted">Don\'t have an account? <a id="sign-in-link" href="#" ng-click="showSignUp()">Sign up</a></p></div></div></div></div></div></div>')}])}(),function(e){try{e=angular.module("risevision.common.components.userstate")}catch(t){e=angular.module("risevision.common.components.userstate",[])}e.run(["$templateCache",function(e){e.put("userstate/request-password-reset.html",'<div class="app-launcher-login"><div class="container"><div class="panel"><div class="row"><div class="col-sm-6 col-xs-12"><div class="rise-logo"><img src="https://s3.amazonaws.com/Rise-Images/Website/rise-logo.svg"></div></div><div class="col-sm-6 col-xs-12"><h1 class="u_remove-top">Password Reset</h1><div class="col-xs-12 col-md-8"><div class="panel-body bg-info u_margin-lg-top" ng-show="emailSent"><p class="u_remove-bottom"><i class="fa fa-warning icon-left"></i> <span>An email with password reset instructions has been sent to your email inbox (if it exists in our system).</span></p></div></div><form id="requestResetForm" role="form" name="forms.requestResetForm" novalidate="" ng-show="!emailSent"><div class="col-md-8 col-xs-12 u_margin-md-top"><div class="form-group" ng-class="{\'has-error\': (forms.requestResetForm.$submitted && forms.requestResetForm.username.$invalid)}" show-errors=""><label class="control-label">Email</label> <input type="text" class="form-control" name="username" ng-model="credentials.username" required="" focus-me="true"><p class="text-danger" ng-show="forms.requestResetForm.$submitted && forms.requestResetForm.username.$invalid">Please enter an Email</p></div><button class="btn btn-primary btn-hg" ng-disabled="forms.requestResetForm.$invalid" ng-click="requestPasswordReset()">Reset Password</button></div></form><br><div class="col-xs-12 u_margin-lg-top"><p class="text-muted"><a id="sign-in-link" href="#" ui-sref="common.auth.unauthorized">Sign in</a> to your account instead.</p></div></div></div></div></div></div>')}])}(),function(e){try{e=angular.module("risevision.common.components.userstate")}catch(t){e=angular.module("risevision.common.components.userstate",[])}e.run(["$templateCache",function(e){e.put("userstate/reset-password-confirm.html",'<div class="app-launcher-login"><div class="container"><div class="panel"><div class="row"><div class="col-sm-6 col-xs-12"><div class="rise-logo"><img src="https://s3.amazonaws.com/Rise-Images/Website/rise-logo.svg"></div></div><div class="col-sm-6 col-xs-12"><h1 class="u_remove-top">Password Confirmation</h1><div><div class="panel-body bg-info u_margin-lg-top" ng-show="emailResetSent"><p class="u_remove-bottom"><i class="fa fa-warning icon-left"></i> <span>An email with password reset instructions has been sent to your email inbox.</span></p></div><div class="panel-body bg-danger u_margin-lg-top" ng-show="invalidPassword"><p class="u_remove-bottom"><i class="fa fa-warning icon-left"></i> <span>New Password must be at least four characters long.</span></p></div><div class="panel-body bg-danger u_margin-lg-top" ng-show="notMatchingPassword"><p class="u_remove-bottom"><i class="fa fa-warning icon-left"></i> <span>New Password and Confirm Password must match.</span></p></div><div class="panel-body bg-danger u_margin-lg-top" ng-show="invalidToken"><p class="u_remove-bottom"><i class="fa fa-warning icon-left"></i> <span>The password reset token is not valid. <a href="#" ng-click="requestPasswordReset()">Request Password Reset</a></span></p></div></div><form id="resetPasswordForm" role="form" name="forms.resetPasswordForm" novalidate="" ng-show="!emailResetSent"><div class="col-md-8 col-xs-12 u_margin-md-top"><div class="form-group" ng-class="{\'has-error\': (forms.resetPasswordForm.$submitted && forms.resetPasswordForm.newPassword.$invalid)}" show-errors=""><label class="control-label">New Password</label> <input type="password" class="form-control" name="name" ng-model="credentials.newPassword" required="" focus-me="true"></div><div class="form-group" ng-class="{\'has-error\': (forms.resetPasswordForm.$submitted && forms.resetPasswordForm.confirmPassword.$invalid)}" show-errors=""><label class="control-label">Confirm Password</label> <input type="password" class="form-control" name="name" ng-model="credentials.confirmPassword" required=""></div><button id="startError" class="btn btn-primary btn-hg" ng-disabled="forms.resetPasswordForm.$invalid" ng-click="resetPassword()">Update Password</button></div></form></div></div></div></div></div>')}])}();