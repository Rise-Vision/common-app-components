!function(e){"use strict";try{e.module("risevision.common.config")}catch(t){e.module("risevision.common.config",[])}e.module("risevision.common.config").value("ENABLE_EXTERNAL_LOGGING",!0).value("CORE_URL","https://rvaserver2.appspot.com/_ah/api"),e.module("risevision.common.components.util",[]),e.module("risevision.common.components.logging",[]),e.module("risevision.common.components.rvtokenstore",["risevision.common.components.util","LocalStorageModule","ngBiscuit"]),e.module("risevision.common.components.userstate",["ui.router","risevision.common.components.util","risevision.common.components.rvtokenstore","risevision.common.components.logging","risevision.common.config","risevision.common.gapi","LocalStorageModule","risevision.core.cache","risevision.core.oauth2","risevision.core.company","risevision.core.util","risevision.core.userprofile","risevision.common.loading","risevision.ui-flow"]).config(["$urlRouterProvider","$stateProvider","$locationProvider",function(e,t,n){n.html5Mode(!0),e.otherwise("/"),t.state("common",{template:"<div ui-view></div>"}).state("common.auth",{"abstract":!0,template:'<div class="app-launcher" ui-view></div>'}).state("common.auth.unauthorized",{templateProvider:["$templateCache",function(e){return e.get("userstate/login.html")}],controller:"LoginCtrl"}).state("common.auth.createaccount",{templateProvider:["$templateCache",function(e){return e.get("userstate/create-account.html")}],controller:"LoginCtrl"}).state("common.auth.unregistered",{templateProvider:["$templateCache",function(e){return e.get("userstate/signup.html")}],controller:"SignUpCtrl"})}]).run(["$rootScope","$state",function(e,t){e.$on("risevision.user.signedOut",function(){t.go("common.auth.unauthorized")});var n;e.$on("$stateChangeStart",function(e,t){t&&-1===t.name.indexOf("common.auth")&&(n=t)}),e.$on("risevision.user.authorized",function(){n&&-1!==t.current.name.indexOf("common.auth")&&t.go(n)})}]).value("CLIENT_ID","614513768474.apps.googleusercontent.com")}(angular),angular.module("risevision.common.components.userstate").factory("canAccessApps",["$q","userState","userAuthFactory","$state",function(e,t,n,o){return function(){var r=e.defer();return n.authenticate(!1).then(function(){return t.isRiseVisionUser()?(r.resolve(),void 0):e.reject()}).then(null,function(){t.isLoggedIn()?o.go("common.auth.unregistered"):o.go("common.auth.unauthorized"),r.reject()}),r.promise}}]),angular.module("risevision.common.components.logging").factory("bigQueryLogging",["externalLogging","userState",function(e,t){var n={};return n.logEvent=function(n,o,r,s,i){return e.logEvent(n,o,r,s||t.getUsername(),i||t.getSelectedCompanyId())},n}]),function(e){"use strict";e.module("risevision.common.components.userstate").factory("companyState",["$location","getCompany","objectHelper","$rootScope","$log","$q",function(t,n,o,r,s,i){var a,u={userCompany:{},selectedCompany:{}},c=function(){o.clearObj(u.selectedCompany),o.clearObj(u.userCompany),s.debug("Company state has been reset.")};t.search().cid&&(s.debug("cid",t.search().cid,"saved for later processing."),a=t.search().cid);var l=function(){var e=i.defer();return n().then(function(e){var t=d.getSelectedCompanyId()?d.getSelectedCompanyId():a;return o.clearAndCopy(e,u.userCompany),m(t)}).then(null,function(){d.resetCompany()}).finally(function(){a=null,e.resolve(null)}),e.promise},m=function(e){var t=i.defer();return e&&e!==u.userCompany.id?n(e).then(function(e){o.clearAndCopy(e,u.selectedCompany),t.resolve(),r.$broadcast("risevision.company.selectedCompanyChanged")}).then(null,function(e){console.error("Failed to load selected company.",e),t.reject(e)}):(d.resetCompany(),t.resolve()),t.promise},d={init:l,switchCompany:m,updateCompanySettings:function(e){e&&e.id===d.getSelectedCompanyId()&&o.clearAndCopy(e,u.selectedCompany),e&&e.id===d.getUserCompanyId()&&o.clearAndCopy(e,u.userCompany),r.$broadcast("risevision.company.updated",{companyId:e.id})},resetCompany:function(){o.clearAndCopy(u.userCompany,u.selectedCompany),r.$broadcast("risevision.company.selectedCompanyChanged")},resetCompanyState:c,getUserCompanyId:function(){return u.userCompany&&u.userCompany.id||null},getUserCompanyName:function(){return u.userCompany&&u.userCompany.name||null},getSelectedCompanyId:function(){return u.selectedCompany&&u.selectedCompany.id||null},getSelectedCompanyName:function(){return u.selectedCompany&&u.selectedCompany.name||null},getSelectedCompanyCountry:function(){return u.selectedCompany&&u.selectedCompany.country||null},getCopyOfUserCompany:function(t){return t?e.extend({},u.userCompany):o.follow(u.userCompany)},getCopyOfSelectedCompany:function(t){return t?e.extend({},u.selectedCompany):o.follow(u.selectedCompany)},isSubcompanySelected:function(){return u.selectedCompany&&u.selectedCompany.id!==(u.userCompany&&u.userCompany.id)},isTestCompanySelected:function(){return u.selectedCompany&&u.selectedCompany.isTest===!0},isSeller:function(){return u.selectedCompany&&u.selectedCompany.sellerId?!0:!1},isRootCompany:function(){return u.userCompany&&!u.userCompany.parentId}};return d}])}(angular),function(e){"use strict";e.module("risevision.common.components.userstate").factory("customAuthFactory",["$q","$log","gapiLoader","userauth","userState",function(e,t,n,o,r){var s={};return s.authenticate=function(t){var s=e.defer(),i=r._state;return t&&t.username&&t.password?e.all([n(),o.login(t.username,t.password)]).then(function(e){var n=e[0],o=e[1]&&e[1].result;if(o&&o.item){var r={access_token:o.item,expires_in:"3600",token_type:"Bearer"};n.auth.setToken(r),s.resolve({email:t.username,token:r})}else s.reject()}).then(null,function(){s.reject()}):i.userToken&&i.userToken.token?n().then(function(e){e.auth.setToken(i.userToken.token),s.resolve(i.userToken)}):s.reject(),s.promise},s.addUser=function(t){var n=e.defer();return t&&t.username&&t.password?o.add(t.username,t.password).then(function(){n.resolve()}).then(null,function(){n.reject()}):n.reject(),n.promise},s}])}(angular),angular.module("risevision.common.components.logging").constant("EXTERNAL_LOGGER_SERVICE_URL","https://www.googleapis.com/bigquery/v2/projects/client-side-events/datasets/Apps_Events/tables/TABLE_ID/insertAll").constant("EXTERNAL_LOGGER_REFRESH_URL","https://www.googleapis.com/oauth2/v3/token?client_id=1088527147109-6q1o2vtihn34292pjt4ckhmhck0rk0o7.apps.googleusercontent.com&client_secret=nlZyrcPLg6oEwO9f9Wfn29Wh&refresh_token=1/xzt4kwzE1H7W9VnKB8cAaCx6zb4Es4nKEoqaYHdTD15IgOrJDtdun6zK6XiATCKT&grant_type=refresh_token").factory("externalLogging",["$http","$window","$q","$log","EXTERNAL_LOGGER_REFRESH_URL","EXTERNAL_LOGGER_SERVICE_URL","ENABLE_EXTERNAL_LOGGING",function(e,t,n,o,r,s,i){var a,u,c={},l=function(){var e=new Date,t=e.getUTCFullYear(),n=e.getUTCMonth()+1,o=e.getUTCDate();return 10>n&&(n="0"+n),10>o&&(o="0"+o),t.toString()+n.toString()+o.toString()},m={kind:"bigquery#tableDataInsertAllRequest",skipInvalidRows:!1,ignoreUnknownValues:!1,templateSuffix:l(),rows:[{insertId:"",json:{event:"",event_details:"",event_value:0,host:"",ts:0,user_id:"",company_id:""}}]};return c.logEvent=function(r,a,u,l,d){if(o.debug("BQ log",r,a,u,l,d),i===!1)return o.debug("External Logging DISABLED"),void 0;var p=n.defer();return c.getToken().then(function(n){var i=JSON.parse(JSON.stringify(m)),c=s.replace("TABLE_ID","apps_events");i.rows[0].insertId=Math.random().toString(36).substr(2).toUpperCase(),i.rows[0].json.event=r,a&&(i.rows[0].json.event_details=a),u&&(i.rows[0].json.event_value=u),i.rows[0].json.user_id=l||"",i.rows[0].json.company_id=d||"",i.rows[0].json.host=t.location.hostname,i.rows[0].json.ts=(new Date).toISOString(),e.post(c,i,{headers:{"Content-Type":"application/json",Authorization:"Bearer "+n}}).then(function(e){p.resolve(e)},function(e){o.debug("error posting to BQ",e),p.reject(e)})},function(e){o.debug("BQ token ERROR",e),p.reject(e)}),p.promise},c.getToken=function(){var t=n.defer();return a&&(new Date).getTime()-u<358e4?t.resolve(a):e.post(r).then(function(e){a=e.data.access_token,u=(new Date).getTime(),t.resolve(e.data.access_token)},function(){t.reject()}),t.promise},c}]),function(e){"use strict";e.module("risevision.common.components.userstate").value("OAUTH2_SCOPES","https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/userinfo.profile").value("GOOGLE_OAUTH2_URL","https://accounts.google.com/o/oauth2/auth").run(["$location","$log","userState","urlStateService","parseParams",function(e,t,n,o,r){var s=e.path(),i=r(s);t.debug("URL params",i),n._restoreState(),i.access_token&&n._setUserToken(i),i.state&&o.redirectToState(i.state)}]).factory("googleAuthFactory",["$q","$log","$location","$interval","$window","$http","gapiLoader","getOAuthUserInfo","uiFlowManager","getBaseDomain","userState","urlStateService","CLIENT_ID","OAUTH2_SCOPES","GOOGLE_OAUTH2_URL",function(e,t,n,o,r,s,i,a,u,c,l,m,d,p,g){var f=null,v=function(){o.cancel(f),f=o(function(){o.cancel(f),y()},33e5)},h=function(o){var r=e.defer(),a=l._state,u={client_id:d,scope:p,cookie_policy:n.protocol()+"://"+c()};return u.authuser="dummy"!==a.userToken?a.userToken.email:s.get("https://www.googleapis.com/oauth2/v1/userinfo?access_token="+a.params.access_token).then(function(e){return e.data.email},function(){return t.debug("Error retrieving userinfo"),u.authuser}),o?u.immediate=!0:u.prompt="select_account",e.all([i(),u.authuser]).then(function(e){var t=e[0];return u.authuser=e[1],t.auth.setToken(a.params),t.auth.authorize(u)}).then(function(e){t.debug("authResult"),e&&!e.error?(a.params&&delete a.params,v(),r.resolve(e)):r.reject(e.error||"failed to authorize user")}).then(null,r.reject),r.promise},y=function(t){var n,o=e.defer();return h(!t).then(function(e){return n=e,a()}).then(function(e){o.resolve(e)}).then(null,function(e){o.reject(e)}),o.promise},C=function(t){if(t){var n,o;return n=r.location.origin+"/",o=encodeURIComponent(m.get()),l._persistState(),u.persist(),r.location.href=g+"?response_type=token&scope="+encodeURIComponent(p)+"&client_id="+d+"&redirect_uri="+encodeURIComponent(n)+"&prompt=select_account&state="+o,e.resolve()}return y(t)},b={authenticate:l._state.inRVAFrame?y:C};return b}])}(angular),function(e){"use strict";e.module("risevision.common.components.rvtokenstore").service("rvTokenStore",["$log","$location","cookieStore","getBaseDomain",function(e,t,n,o){var r=function(){var e=n.get("rv-token");try{return JSON.parse(e)}catch(t){return e}},s=function(e){var t=o();"localhost"===t?n.put("rv-token",JSON.stringify(e),{path:"/"}):n.put("rv-token",JSON.stringify(e),{domain:t,path:"/"})},i=function(){var e=o();"localhost"===e?n.remove("rv-token",{path:"/"}):n.remove("rv-token",{domain:e,path:"/"})},a={read:r,write:s,clear:i};return a}])}(angular),function(e){"use strict";e.module("risevision.common.components.userstate").run(["$rootScope","userState","selectedCompanyUrlHandler",function(e,t,n){e.$on("risevision.company.selectedCompanyChanged",function(e){e&&n.updateUrl()}),e.$on("$stateChangeSuccess",n.updateSelectedCompanyFromUrl),e.$on("$routeChangeSuccess",n.updateSelectedCompanyFromUrl),e.$on("$locationChangeSuccess",n.locationChangeSuccess)}]).service("selectedCompanyUrlHandler",["$state","$stateParams","$location","userState",function(e,t,n,o){this.updateUrl=function(){var r=o.getSelectedCompanyId();r&&n.search().cid!==r&&!e.transition&&(t.cid=r,e.params.cid=r,n.search("cid",r))},this.updateSelectedCompanyFromUrl=function(){var r=n.search().cid;if(r&&o.getUserCompanyId()&&r!==o.getSelectedCompanyId())o.switchCompany(r);else if(!r&&o.getSelectedCompanyId()){var s=n.absUrl();t.cid=o.getSelectedCompanyId(),e.params.cid=o.getSelectedCompanyId(),n.search("cid",o.getSelectedCompanyId()),s===n.destUrl&&n.replace()}},this.locationChangeSuccess=function(e,t){n.destUrl=t}}])}(angular),function(e){"use strict";e.module("risevision.common.components.userstate").factory("urlStateService",["$window","$location","userState",function(e,t,n){var o={};return o.get=function(){var t,n,o;return t=e.location.pathname?e.location.pathname.substring(1):"",n=e.location.search,o=encodeURIComponent(JSON.stringify({p:t,u:e.location.hash,s:n}))},o.redirectToState=function(o){var r=JSON.parse(decodeURIComponent(o));r.p||r.s?(n._persistState(),e.location.replace(r.p+r.s+r.u)):t.$$html5?t.path(""):e.location.hash=r.u},o}])}(angular),function(e){"use strict";e.module("risevision.common.components.userstate").factory("userAuthFactory",["$q","$log","$location","$rootScope","$loading","$window","$document","gapiLoader","objectHelper","rvTokenStore","externalLogging","userState","googleAuthFactory","customAuthFactory",function(t,n,o,r,s,i,a,u,c,l,m,d,p,g){var f,v,h=d._state,y=!0,C=function(e){if(y){y=!1;try{var t=(new Date).getTime()-i.performance.timing.navigationStart;m.logEvent("page load time",e,t,d.getUsername(),d.getSelectedCompanyId())}catch(o){n.debug("Error logging load time")}}},b=function(e){h.userToken=e,l.write(h.userToken)},S=function(){},w=function(){n.debug("Clearing user token..."),S(),h.userToken=null,l.clear()},_=function(){var t=l.read();e.equals(t,h.userToken)?h.userToken&&(v=null,T(!1).finally(function(){h.userToken||(n.debug("Authentication failed. Reloading..."),i.location.reload())})):i.location.reload()},k=function(){var e,t=a[0];"undefined"!=typeof t.hidden?e="visibilityState":"undefined"!=typeof t.mozHidden?e="mozVisibilityState":"undefined"!=typeof t.msHidden?e="msVisibilityState":"undefined"!=typeof t.webkitHidden&&(e="webkitVisibilityState"),n.debug("visibility: "+t[e]),"visible"===t[e]&&_()},$=function(){var e,t=a[0];return"undefined"!=typeof t.hidden?e="visibilitychange":"undefined"!=typeof t.mozHidden?e="mozvisibilitychange":"undefined"!=typeof t.msHidden?e="msvisibilitychange":"undefined"!=typeof t.webkitHidden&&(e="webkitvisibilitychange"),e},U=function(){document.addEventListener($(),k)},E=function(){document.removeEventListener($(),k)};U();var R=function(e){var n=!1;return f?f.promise:e?h.user.username&&h.profile.username&&h.user.username===e.email?t.resolve():(f=t.defer(),c.clearAndCopy({userId:e.id,username:e.email,picture:e.picture},h.user),b(e),d.refreshProfile().finally(function(){f.resolve(),r.$broadcast("risevision.user.authorized"),n||r.$broadcast("risevision.user.userSignedIn"),f=void 0}),f.promise):(c.clearObj(h.user),t.reject("No user"))},T=function(o,r){var i;if(o&&(v=null,d._resetState()),v)return v.promise;v=t.defer(),i=v,n.debug("authentication called");var a=function(){var t=e.isDefined(h.userToken)&&null!==h.userToken;if(n.debug("userAuthed",t),o||t===!0){var a;a=r||h.userToken&&h.userToken.token?g.authenticate(r):p.authenticate(o),a.then(R).then(function(){i.resolve()}).then(null,function(e){w(),n.debug("Authentication Error: "+e),i.reject(e)}).finally(function(){s.stopGlobal("risevision.user.authenticate"),C("authenticated user")})}else{var u="user is not authenticated";n.debug(u),i.reject(u),c.clearObj(h.user),s.stopGlobal("risevision.user.authenticate"),C("unauthenticated user")}};return u().finally(a),o&&s.startGlobal("risevision.user.authenticate"),i.promise},I=function(e){return u().then(function(t){e&&(i.logoutFrame.location="https://accounts.google.com/Logout"),t.auth.signOut(),v=null,w(),d._resetState(),r.$broadcast("risevision.user.signedOut"),n.debug("User is signed out.")})},A={authenticate:T,authenticatePopup:function(){return T(!0)},signOut:I,addEventListenerVisibilityAPI:U,removeEventListenerVisibilityAPI:E};return A}])}(angular),function(){"use strict";angular.module("risevision.common.components.userstate").service("userauth",["$q","$log","riseAPILoader",function(e,t,n){var o={add:function(o,r){var s=e.defer(),i={username:o,password:r};return n().then(function(e){return e.userauth.add(i)}).then(function(e){t.debug("added user credentials",e),s.resolve(e.result)}).then(null,function(e){console.error("Failed to add credentials.",e),s.reject(e)}),s.promise},update:function(o,r){var s=e.defer(),i={username:o,password:r};return n().then(function(e){return e.userauth.update(i)}).then(function(e){t.debug("update user credentials resp",e),s.resolve(e.result)}).then(null,function(e){console.error("Failed to update credentials.",e),s.reject(e)}),s.promise},login:function(o,r){var s=e.defer(),i={username:o,password:r};return n().then(function(e){return e.userauth.login(i)}).then(function(e){t.debug("login successful",e),s.resolve(e)}).then(null,function(e){console.error("Failed to login user.",e),s.reject(e)}),s.promise},refreshToken:function(o,r){var s=e.defer(),i={username:o,token:r};return n().then(function(e){return e.userauth.refreshToken(i)}).then(function(e){t.debug("token refresh successful",e),s.resolve(e)}).then(null,function(e){console.error("Failed to refresh token.",e),s.reject(e)}),s.promise}};return o}])}(),function(e){"use strict";e.module("risevision.common.components.userstate").value("DEFAULT_PROFILE_PICTURE","http://api.randomuser.me/portraits/med/men/33.jpg").factory("userState",["$q","$rootScope","$window","$log","$location","userInfoCache","getUserProfile","companyState","objectHelper","localStorageService","rvTokenStore","DEFAULT_PROFILE_PICTURE",function(t,n,o,r,s,i,a,u,c,l,m,d){var p={profile:{},user:{},roleMap:{},userToken:m.read(),inRVAFrame:e.isDefined(s.search().inRVA)},g=function(){var e=t.defer();return a(p.user.username,!0).then(function(e){return S.updateUserProfile(e),u.init()}).then(function(){e.resolve()},e.reject),e.promise},f=function(){return p.user.username?!0:!1},v=function(){return null!==p.profile.username&&void 0!==p.profile.username},h=function(t){return e.isDefined(p.roleMap[t])},y=function(){return o.gapi?o.gapi.auth.getToken():null},C=function(){var t=l.get("risevision.common.userState");t&&(e.extend(p,t),l.remove("risevision.common.userState"),r.debug("userState restored with",t))},b=function(){i.removeAll(),c.clearObj(p.user),c.clearObj(p.profile),p.roleMap={},u.resetCompanyState(),r.debug("User state has been reset.")},S={getUsername:function(){return p.user&&p.user.username||null},getUserEmail:function(){return p.profile.email},getCopyOfProfile:function(t){return t?e.extend({},p.profile):c.follow(p.profile)},getUserPicture:function(){return p.user.picture||d},hasRole:h,inRVAFrame:function(){return p.inRVAFrame},isRiseAdmin:function(){return h("sa")&&u.isRootCompany()},isRiseStoreAdmin:function(){return h("ba")&&u.isRootCompany()},isUserAdmin:function(){return h("ua")},isPurchaser:function(){return h("pu")},isSeller:u.isSeller,isRiseVisionUser:v,isLoggedIn:f,getAccessToken:y,checkUsername:function(e){return!(!e||!S.getUsername()||e.toUpperCase()!==S.getUsername().toUpperCase())},updateUserProfile:function(t){S.checkUsername(t.username)&&(c.clearAndCopy(e.extend({username:p.user.username},t),p.profile),p.roleMap={},p.profile.roles&&p.profile.roles.forEach(function(e){p.roleMap[e]=!0}),n.$broadcast("risevision.user.updated"))},refreshProfile:g,getUserCompanyId:u.getUserCompanyId,getUserCompanyName:u.getUserCompanyName,getSelectedCompanyId:u.getSelectedCompanyId,getSelectedCompanyName:u.getSelectedCompanyName,getSelectedCompanyCountry:u.getSelectedCompanyCountry,getCopyOfUserCompany:u.getCopyOfUserCompany,getCopyOfSelectedCompany:u.getCopyOfSelectedCompany,isSubcompanySelected:u.isSubcompanySelected,isTestCompanySelected:u.isTestCompanySelected,isRootCompany:u.isRootCompany,updateCompanySettings:u.updateCompanySettings,updateUserCompanySettings:u.updateUserCompanySettings,resetCompany:u.resetCompany,switchCompany:u.switchCompany,_restoreState:C,_resetState:b,_setUserToken:function(e){p.params=e,p.userToken="dummy"},_persistState:function(){l.set("risevision.common.userState",p)},_state:p};return S}])}(angular),function(e){"use strict";e.module("risevision.common.components.util").value("humanReadableError",function(e){var t;return t=e.message?e.message:e.error?e.error.message?e.error.message:e.error:e,JSON.stringify(t)}).factory("dateIsInRange",[function(){return function(e,t,n){var o,r,s=!0;try{t&&(o=t.match(/(\d{4})\-(\d{2})\-(\d{2})/),r=new Date(o[1],parseInt(o[2])-1,o[3],0,0,0,0),s=e>=r),s&&n&&(o=n.match(/(\d{4})\-(\d{2})\-(\d{2})/),r=new Date(o[1],parseInt(o[2])-1,o[3],0,0,0,0),s=r>=e)}catch(i){s=!1}return s}}]).factory("objectHelper",[function(){var t={};return t.follow=function(e){var t=function(){};return t.prototype=e,new t},t.clearObj=function(e){for(var t in e)delete e[t]},t.clearAndCopy=function(n,o){t.clearObj(o),e.extend(o,n)},t}]).factory("getBaseDomain",["$log","$location",function(e,t){var n=function(e){return/^([0-9])+\.([0-9])+\.([0-9])+\.([0-9])+$/.test(e)?!0:!1};return function(){var o;if(!o){var r=t.host();if(n(r))o=r;else{var s=r.split(".");o=s.length>1?"appspot"===s[s.length-2]?s.slice(s.length-3).join("."):s.slice(s.length-2).join("."):r}e.debug("baseDomain",o)}return o}}]).value("parseParams",function(e){var t={};return"/"===e[0]&&(e=e.slice(1)),e.split("&").forEach(function(e){var n=e.split("=");t[n[0]]=n[1]}),t})}(angular),angular.module("risevision.common.components.userstate").controller("LoginCtrl",["$scope","$loading","userAuthFactory","customAuthFactory","uiFlowManager",function(e,t,n,o,r){e.forms={},e.credentials={},e.errors={},e.googleLogin=function(e){t.startGlobal("auth-buttons-login"),n.authenticate(!0).finally(function(){t.stopGlobal("auth-buttons-login"),r.invalidateStatus(e)})},e.customLogin=function(o){e.errors={},e.forms.loginForm.$valid&&(t.startGlobal("auth-buttons-login"),n.authenticate(!0,e.credentials).then(function(){}).then(null,function(){e.errors.loginError=!0}).finally(function(){t.stopGlobal("auth-buttons-login"),r.invalidateStatus(o)}))},e.createAccount=function(n){e.errors={},e.forms.loginForm.$valid&&(t.startGlobal("auth-buttons-login"),o.addUser(e.credentials).then(function(){e.errors.confirmationRequired=!0}).then(null,function(){e.errors.duplicateError=!0}).finally(function(){t.stopGlobal("auth-buttons-login"),r.invalidateStatus(n)}))}}]),angular.module("risevision.common.components.userstate").controller("SignUpCtrl",["$scope","userAuthFactory","uiFlowManager","$loading",function(e,t,n,o){e.login=function(e){o.startGlobal("auth-buttons-login"),t.authenticate(!0).then().finally(function(){o.stopGlobal("auth-buttons-login"),n.invalidateStatus(e)})}}]),function(e){try{e=angular.module("risevision.common.components.userstate")}catch(t){e=angular.module("risevision.common.components.userstate",[])}e.run(["$templateCache",function(e){e.put("userstate/auth-form.html",'<form id="forms.loginForm" name="forms.loginForm" role="form" novalidate=""><div><div class="panel-body bg-danger u_margin-sm-top" style="display: block;" ng-show="errors.duplicateError"><p class="u_remove-bottom"><i class="fa fa-warning icon-left"></i> <span>This email address is already registered. You can <a href="#">sign in</a>with this address.</span></p></div><div class="panel-body bg-danger u_margin-sm-top" style="display: block;" ng-show="errors.loginError"><p class="u_remove-bottom"><i class="fa fa-warning icon-left"></i> <span>Your email address (or password) is not found. <a href="#"></a></span></p></div><div class="panel-body bg-danger u_margin-sm-top" style="display: block;" ng-show="errors.unconfirmedError"><p class="u_remove-bottom"><i class="fa fa-warning icon-left"></i> <span>Your email address has not been confirmed.<br><a href="#">Resend Email Confirmation</a></span></p></div><div class="panel-body bg-info u_margin-sm-top" style="display: block;" ng-show="errors.confirmationRequired"><p class="u_remove-bottom"><i class="fa fa-warning icon-left"></i> <span>We\'ve sent a confirmation email to {{credentials.username}}.<br>Please check your inbox to complete your account registration.</span></p></div></div><div class="u_margin-sm-top"><div class="form-group" ng-class="{\'has-error\': (forms.loginForm.$submitted && forms.loginForm.username.$invalid)}" show-errors=""><label class="control-label">Email</label> <input type="text" class="form-control" placeholder="Enter Username" id="username" name="username" ng-model="credentials.username" required="" focus-me="true"><p class="text-danger" ng-show="forms.loginForm.$submitted && forms.loginForm.username.$invalid">Please enter an Email</p></div><div class="form-group" ng-class="{\'has-error\': (forms.loginForm.$submitted && forms.loginForm.password.$invalid)}" show-errors=""><label class="control-label">Password</label> <input type="password" class="form-control" placeholder="Enter Password" id="password" name="password" ng-model="credentials.password" required=""><p class="text-danger" ng-show="forms.loginForm.$submitted && forms.loginForm.password.$invalid">Please enter a Password</p></div></div></form>')}])}(),function(e){try{e=angular.module("risevision.common.components.userstate")}catch(t){e=angular.module("risevision.common.components.userstate",[])}e.run(["$templateCache",function(e){e.put("userstate/create-account.html",'<div class="app-launcher-login"><div class="container"><div class="panel"><div class="row"><div class="col-sm-6 col-xs-12"><div class="rise-logo"><img src="https://s3.amazonaws.com/Rise-Images/Website/rise-logo.svg"></div></div><div class="col-sm-6 col-xs-12"><h1 class="u_remove-top">Get Started For Free</h1><p class="lead text-muted">No commitments or contracts</p><div class="col-xs-12 col-md-8"><button class="btn btn-google-auth btn-hg" ng-click="googleLogin(\'registrationComplete\')"><span><img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg"> Sign up with Google</span></button></div><div class="section-divider col-xs-12 col-md-8 u_margin-md-top"><div></div><span>OR</span><div></div></div><div class="col-md-8 col-xs-12"><div ng-include="\'userstate/auth-form.html\'"></div><div class="form-group"><button class="btn btn-primary btn-hg" type="submit" form="forms.loginForm" ng-click="createAccount(\'registrationComplete\')"><span translate="Sign Up"></span></button></div></div><br><div class="col-xs-12 u_margin-lg-top"><p class="text-muted">Already have an account? <a id="sign-in-link" href="#" ui-sref="common.auth.unauthorized">Sign in</a></p></div></div></div></div></div></div>')}])}(),function(e){try{e=angular.module("risevision.common.components.userstate")}catch(t){e=angular.module("risevision.common.components.userstate",[])}e.run(["$templateCache",function(e){e.put("userstate/login.html",'<div class="app-launcher-login"><div class="container"><div class="panel"><div class="row"><div class="col-sm-6 col-xs-12"><div class="rise-logo"><img src="https://s3.amazonaws.com/Rise-Images/Website/rise-logo.svg"></div></div><div class="col-sm-6 col-xs-12"><h1 class="u_remove-top">Sign In</h1><p class="lead text-muted">to your Rise Vision account</p><div class="col-xs-12 col-md-8"><button class="btn btn-google-auth btn-hg" ng-click="googleLogin(\'registrationComplete\')"><span><img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg"> Sign in with Google</span></button></div><div class="section-divider col-xs-12 col-md-8 u_margin-md-top"><div></div><span>OR</span><div></div></div><div class="col-md-8 col-xs-12"><div ng-include="\'userstate/auth-form.html\'"></div><div class="form-group"><button class="btn btn-primary btn-hg" type="submit" form="forms.loginForm" ng-click="customLogin(\'registrationComplete\')"><span translate="Sign In"></span></button></div></div><br><div class="col-xs-12 u_margin-lg-top"><p class="text-muted"><a id="sign-in-link" href="#" ui-sref="common.auth.protoreset">Forgot your password?</a></p><p class="text-muted">Don\'t have an account? <a id="sign-in-link" href="#" ui-sref="common.auth.createaccount">Sign up</a></p></div></div></div></div></div></div>')}])}(),function(e){try{e=angular.module("risevision.common.components.userstate")}catch(t){e=angular.module("risevision.common.components.userstate",[])}e.run(["$templateCache",function(e){e.put("userstate/signup.html",'<div class="app-launcher-login"><div class="container"><div class="panel"><div class="row"><div class="col-sm-4 col-xs-12"><div class="rise-logo"><img src="https://s3.amazonaws.com/Rise-Images/Website/rise-logo.svg"></div></div><div class="col-sm-8 col-xs-12"><h1 class="u_remove-top" translate="">common.signUp</h1><p class="lead text-muted" translate="">launcher.createAccount</p><button ng-controller="RegisterButtonCtrl" ng-click="register()" class="btn btn-danger btn-hg u_margin-md-bottom" translate="">common.completeRegistration</button><br><p class="text-muted u_margin-md-top"><a id="sign-in-link" href="" ng-controller="SignOutButtonCtrl" ng-click="logout()" translate="">common.signOut</a></p></div></div></div></div></div>')}])}();