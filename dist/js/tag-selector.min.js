"use strict";angular.module("risevision.common.components.tag-selector.services",["risevision.common.gapi"]),angular.module("risevision.common.components.tag-selector",["risevision.common.components.tag-selector.services","risevision.common.loading","ui.bootstrap"]).value("companyId","").value("STORAGE_API_ROOT","https://storage-dot-rvaserver2.appspot.com/_ah/api"),angular.module("risevision.common.components.tag-selector.services").factory("storageApiLoader",["STORAGE_API_ROOT","gapiClientLoaderGenerator",function(e,t){return t("storage","v0.01",e)}]).value("STORAGE_API_ROOT","https://storage-dot-rvaserver2.appspot.com/_ah/api"),angular.module("risevision.common.components.tag-selector.services").service("tag",["$q","userState","storageApiLoader","$log",function(e,t,a,n){var o="LOOKUP",s={},l=function(e){for(var t=[],a=0;a<e.length;a++){var n=e[a];if(n.type===o)for(var s=0;s<n.values.length;s++)t.push({name:n.name,value:n.values[s]})}return t};return s.flatList=function(){var t=e.defer();return s.list().then(function(e){return l(e.items)}).then(function(e){t.resolve(e)}).then(null,function(e){t.reject(e)}),t.promise},s.list=function(){var o=e.defer(),s={companyId:t.getSelectedCompanyId()};return a().then(function(e){return e.tagdef.list(s)}).then(function(e){n.debug("get tag list resp",e),o.resolve(e.result)}).then(null,function(e){n.error("Failed to get tags list.",e),o.reject(e)}),o.promise},s}]),angular.module("risevision.common.components.tag-selector").directive("tagTextbox",["$modal",function(e){return{restrict:"E",scope:{tags:"="},templateUrl:"tag-selector/tag-textbox.html",link:function(t){t.openModal=function(){var a=e.open({templateUrl:"tag-selector/tag-lookup-modal.html",controller:"tagLookup",resolve:{tags:function(){return angular.copy(t.tags)}}});a.result.then(function(e){t.tags=e},function(){})}}}}]),angular.module("risevision.common.components.tag-selector").controller("tagLookup",["$scope","tag","$modalInstance","$loading","$log","tags",function(e,t,a,n,o,s){e.loadingTags=!1,e.selectedTags=s?s:[],e.$watch("loadingTags",function(e){e?n.start("tag-loader"):n.stop("tag-loader")});var l=function(){e.loadingTags=!0,t.flatList().then(function(t){e.availableTags=t}).then(null,function(e){o.error("Could not load tags: ",e)}).finally(function(){e.loadingTags=!1})};l(),e.selectTag=function(t){e.selectedTags.push(t)},e.removeTag=function(t){t>-1&&e.selectedTags.splice(t,1)},e.cancel=function(){a.dismiss()},e.apply=function(){a.close(e.selectedTags)}}]),angular.module("risevision.common.components.tag-selector").filter("tagSelection",[function(){return function(e,t){if(!e)return[];for(var a=[],n=0;n<e.length;n++){for(var o=!1,s=0;s<t.length;s++)if(e[n].name===t[s].name&&e[n].value===t[s].value){o=!0;break}o||a.push(e[n])}return a}}]),function(e){try{e=angular.module("risevision.common.components.tag-selector")}catch(t){e=angular.module("risevision.common.components.tag-selector",[])}e.run(["$templateCache",function(e){e.put("tag-selector/tag-lookup-modal.html",'<div><div class="modal-body"><div rv-spinner="" rv-spinner-key="tag-loader" rv-spinner-start-active="0"></div><div class="content-box selected-tags content-box-editable"><div class="label label-tag" ng-repeat="tag in selectedTags" ng-click="removeTag($index)">{{tag.name}}: <span class="tag-value">{{tag.value}}</span> <span><i class="fa fa-minus-circle"></i></span></div></div><div class="content-box select-tags half-top"><div class="input-group"><span class="input-group-addon"><i class="fa fa-search"></i></span> <input type="text" class="form-control" placeholder="Search Lookup Tags" ng-model="query"></div><div class="label label-tag" ng-repeat="tag in availableTags | tagSelection:selectedTags | filter:query" ng-click="selectTag(tag)">{{tag.name}}: <span class="tag-value">{{tag.value}}</span> <span><i class="fa fa-plus-circle"></i></span></div></div></div><div class="modal-footer"><button type="button" class="btn btn-primary btn-fixed-width" ng-click="apply()">Apply <i class="fa fa-white fa-check icon-right"></i></button> <button type="button" class="btn btn-default btn-fixed-width" ng-click="cancel()">Cancel <i class="fa fa-times icon-right"></i></button></div></div>')}])}(),function(e){try{e=angular.module("risevision.common.components.tag-selector")}catch(t){e=angular.module("risevision.common.components.tag-selector",[])}e.run(["$templateCache",function(e){e.put("tag-selector/tag-textbox.html",'<div class="content-box content-box-editable clickable add-bottom" ng-click="openModal()"><span class="edit-icon"><i class="fa fa-lg fa-pencil"></i></span><div class="label label-tag" ng-repeat="tag in tags"><span class="tag-name">{{tag.name}}</span> <span class="tag-value">{{tag.value}}</span></div></div>')}])}();