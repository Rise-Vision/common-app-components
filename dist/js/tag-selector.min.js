"user strict";angular.module("risevision.common.components.tag-selector.services",["risevision.common.gapi"]),angular.module("risevision.common.components.tag-selector",["risevision.common.components.tag-selector.services","risevision.common.loading","ui.bootstrap"]).value("companyId","").value("STORAGE_API_ROOT","https://storage-dot-rvaserver2.appspot.com/_ah/api"),angular.module("risevision.common.components.tag-selector.services").factory("storageApiLoader",["STORAGE_API_ROOT","gapiClientLoaderGenerator",function(e,n){return n("storage","v0.01",e)}]).value("STORAGE_API_ROOT","https://storage-dot-rvaserver2.appspot.com/_ah/api"),angular.module("risevision.common.components.tag-selector.services").service("tag",["$q","userState","storageApiLoader","$log",function(e,n,t,a){var o="LOOKUP",s={},l=function(e){for(var n=[],t=0;t<e.length;t++){var a=e[t];if(a.type===o)for(var s=0;s<a.values.length;s++)n.push({name:a.name,value:a.values[s]})}return n};return s.flatList=function(){var n=e.defer();return s.list().then(function(e){return l(e.items)}).then(function(e){n.resolve(e)}).then(null,function(e){n.reject(e)}),n.promise},s.list=function(){var o=e.defer(),s={companyId:n.getSelectedCompanyId()};return t().then(function(e){return e.tagdef.list(s)}).then(function(e){a.debug("get tag list resp",e),o.resolve(e.result)}).then(null,function(e){a.error("Failed to get tags list.",e),o.reject(e)}),o.promise},s}]),angular.module("risevision.common.components.tag-selector").directive("tagTextbox",["$modal",function(e){return{restrict:"E",scope:{tags:"="},templateUrl:"tag-selector/tag-textbox.html",link:function(n){n.openModal=function(){var t=e.open({templateUrl:"tag-selector/tag-lookup-modal.html",controller:"tagLookup",resolve:{tags:function(){return angular.copy(n.tags)}}});t.result.then(function(e){n.tags=e},function(){})}}}}]),angular.module("risevision.common.components.tag-selector").controller("tagLookup",["$scope","tag","$modalInstance","$loading","$log","tags",function(e,n,t,a,o,s){e.loadingTags=!1,e.selectedTags=s?s:[],e.$watch("loadingTags",function(e){e?a.start("tag-loader"):a.stop("tag-loader")});var l=function(){e.loadingTags=!0,n.flatList().then(function(n){e.availableTags=n}).then(null,function(e){o.error("Could not load tags: ",e)}).finally(function(){e.loadingTags=!1})};l(),e.selectTag=function(n){e.selectedTags.push(n)},e.removeTag=function(n){n>-1&&e.selectedTags.splice(n,1)},e.cancel=function(){t.dismiss()},e.apply=function(){t.close(e.selectedTags)}}]),angular.module("risevision.common.components.tag-selector").filter("tagSelection",[function(){return function(e,n){if(!e)return[];for(var t=[],a=0;a<e.length;a++){for(var o=!1,s=0;s<n.length;s++)if(e[a].name===n[s].name&&e[a].value===n[s].value){o=!0;break}o||t.push(e[a])}return t}}]),function(){try{app=angular.module("risevision.common.components.tag-selector")}catch(e){app=angular.module("risevision.common.components.tag-selector",[])}app.run(["$templateCache",function(e){"use strict";e.put("tag-selector/tag-lookup-modal.html",'<div>\n  \n  <div class="modal-body">\n    <div rv-spinner rv-spinner-key="tag-loader" rv-spinner-start-active="0"></div>\n    \n    <div class="content-box selected-tags content-box-editable">\n      <div class="label label-tag" ng-repeat="tag in selectedTags" ng-click="removeTag($index)">      \n        {{tag.name}}: <span class="tag-value">{{tag.value}}</span>\n        <span><i class="fa fa-minus-circle"></i></span>\n      </div>       \n    </div>\n    \n    <div class="content-box select-tags half-top">\n      <div class="input-group">\n        <span class="input-group-addon"><i class="fa fa-search"></i></span>\n        <input type="text" class="form-control" placeholder="Search Lookup Tags" ng-model="query">\n      </div>\n      \n      <div class="label label-tag" ng-repeat="tag in availableTags | tagSelection:selectedTags | filter:query" ng-click="selectTag(tag)">\n        {{tag.name}}: <span class="tag-value">{{tag.value}}</span>\n        <span><i class="fa fa-plus-circle"></i></span>\n      </div>    \n    </div>\n    \n  </div><!-- modal-body -->  \n  \n  <div class="modal-footer">\n    <button type="button" class="btn btn-primary btn-fixed-width"  ng-click="apply()">Apply <i class="fa fa-white fa-check icon-right"></i></button>\n    <button type="button" class="btn btn-default btn-fixed-width" ng-click="cancel()">Cancel <i class="fa fa-times icon-right"></i></button>\n  </div>\n  \n</div><!-- end: controller --> \n')}])}(),function(){try{app=angular.module("risevision.common.components.tag-selector")}catch(e){app=angular.module("risevision.common.components.tag-selector",[])}app.run(["$templateCache",function(e){"use strict";e.put("tag-selector/tag-textbox.html",'<div class="content-box content-box-editable clickable add-bottom" ng-click="openModal()">\n  <span class="edit-icon"><i class="fa fa-lg fa-pencil"></i></span>\n  <div class="label label-tag" ng-repeat="tag in tags">\n    <span class="tag-name">{{tag.name}}</span> <span class="tag-value">{{tag.value}}</span>\n  </div>   \n</div>\n')}])}();