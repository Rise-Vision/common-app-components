"use strict";angular.module("risevision.common.components.timeline.services",[]),angular.module("risevision.common.components.timeline",["risevision.common.components.timeline.services","ui.bootstrap"]),angular.module("risevision.common.components.timeline.services").factory("TimelineFactory",[function(){return function(e){var r={DAILY:"Daily",WEEKLY:"Weekly",MONTHLY:"Monthly",YEARLY:"Yearly"},n=function(e,r){var n=new Date;return t.useLocaldate?n=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),e,r,0)):(n.setHours(e),n.setMinutes(r),n.setSeconds(0),n=n.toLocaleDateString("en-US")+" "+n.toLocaleTimeString("en-US")),n},t=e,l={daily:{recurrenceFrequency:1},weekly:{recurrenceFrequency:1},monthly:{recurrenceAbsolute:!0,absolute:{recurrenceFrequency:1,recurrenceDayOfMonth:1},relative:{recurrenceFrequency:1,recurrenceWeekOfMonth:0,recurrenceDayOfWeek:0}},yearly:{recurrenceAbsolute:!0,absolute:{recurrenceMonthOfYear:0,recurrenceDayOfMonth:1},relative:{recurrenceDayOfWeek:0,recurrenceWeekOfMonth:0,recurrenceMonthOfYear:0}}},c=function(){if(t.recurrenceType===r.DAILY)l.daily.recurrenceFrequency=t.recurrenceFrequency;else if(t.recurrenceType===r.WEEKLY){l.weekly.recurrenceFrequency=t.recurrenceFrequency;for(var e=0;e<t.recurrenceDaysOfWeek.length;e++)"Mon"===t.recurrenceDaysOfWeek[e]?l.weekly.monday=!0:"Tue"===t.recurrenceDaysOfWeek[e]?l.weekly.tuesday=!0:"Wed"===t.recurrenceDaysOfWeek[e]?l.weekly.wednesday=!0:"Thu"===t.recurrenceDaysOfWeek[e]?l.weekly.thursday=!0:"Fri"===t.recurrenceDaysOfWeek[e]?l.weekly.friday=!0:"Sat"===t.recurrenceDaysOfWeek[e]?l.weekly.saturday=!0:"Sun"===t.recurrenceDaysOfWeek[e]&&(l.weekly.sunday=!0)}else t.recurrenceType===r.MONTHLY?(l.monthly.recurrenceAbsolute=t.recurrenceAbsolute,t.recurrenceAbsolute?(l.monthly.absolute.recurrenceFrequency=t.recurrenceFrequency,l.monthly.absolute.recurrenceDayOfMonth=t.recurrenceDayOfMonth):(l.monthly.relative.recurrenceFrequency=t.recurrenceFrequency,l.monthly.relative.recurrenceWeekOfMonth=t.recurrenceWeekOfMonth,l.monthly.relative.recurrenceDayOfWeek=t.recurrenceDayOfWeek)):t.recurrenceType===r.YEARLY&&(l.yearly.recurrenceAbsolute=t.recurrenceAbsolute,t.recurrenceAbsolute?(l.yearly.absolute.recurrenceMonthOfYear=t.recurrenceMonthOfYear,l.yearly.absolute.recurrenceDayOfMonth=t.recurrenceDayOfMonth):(l.yearly.relative.recurrenceDayOfWeek=t.recurrenceDayOfWeek,l.yearly.relative.recurrenceWeekOfMonth=t.recurrenceWeekOfMonth,l.yearly.relative.recurrenceMonthOfYear=t.recurrenceMonthOfYear))},a=function(){t.everyDay=!t.startDate,t.startDate=t.startDate||n(0,0),t.endDate=t.endDate||null,t.startTime=t.startTime||null,t.endTime=t.endTime||null,t.allDay=!(t.startTime||t.endTime),t.allDay&&(t.startTime=n(8,0),t.endTime=n(17,30)),t.recurrenceType=t.recurrenceType||r.DAILY,t.recurrenceFrequency=t.recurrenceFrequency||1,t.recurrenceAbsolute=t.hasOwnProperty("recurrenceAbsolute")?t.recurrenceAbsolute:!0,t.recurrenceDayOfWeek=t.recurrenceDayOfWeek||0,t.recurrenceDayOfMonth=t.recurrenceDayOfMonth||1,t.recurrenceWeekOfMonth=t.recurrenceWeekOfMonth||0,t.recurrenceMonthOfYear=t.recurrenceMonthOfYear||0,t.recurrenceDaysOfWeek=t.recurrenceDaysOfWeek||[],c()};a();var o=function(){t.recurrenceType===r.DAILY?t.recurrenceFrequency=l.daily.recurrenceFrequency:t.recurrenceType===r.WEEKLY?(t.recurrenceFrequency=l.weekly.recurrenceFrequency,t.recurrenceDaysOfWeek=[],l.weekly.monday&&t.recurrenceDaysOfWeek.push("Mon"),l.weekly.tuesday&&t.recurrenceDaysOfWeek.push("Tue"),l.weekly.wednesday&&t.recurrenceDaysOfWeek.push("Wed"),l.weekly.thursday&&t.recurrenceDaysOfWeek.push("Thu"),l.weekly.friday&&t.recurrenceDaysOfWeek.push("Fri"),l.weekly.saturday&&t.recurrenceDaysOfWeek.push("Sat"),l.weekly.sunday&&t.recurrenceDaysOfWeek.push("Sun")):t.recurrenceType===r.MONTHLY?(t.recurrenceAbsolute=l.monthly.recurrenceAbsolute,t.recurrenceAbsolute?(t.recurrenceFrequency=l.monthly.absolute.recurrenceFrequency,t.recurrenceDayOfMonth=l.monthly.absolute.recurrenceDayOfMonth):(t.recurrenceFrequency=l.monthly.relative.recurrenceFrequency,t.recurrenceWeekOfMonth=l.monthly.relative.recurrenceWeekOfMonth,t.recurrenceDayOfWeek=l.monthly.relative.recurrenceDayOfWeek)):t.recurrenceType===r.YEARLY&&(t.recurrenceAbsolute=l.yearly.recurrenceAbsolute,t.recurrenceAbsolute?(t.recurrenceMonthOfYear=l.yearly.absolute.recurrenceMonthOfYear,t.recurrenceDayOfMonth=l.yearly.absolute.recurrenceDayOfMonth):(t.recurrenceDayOfWeek=l.yearly.relative.recurrenceDayOfWeek,t.recurrenceWeekOfMonth=l.yearly.relative.recurrenceWeekOfMonth,t.recurrenceMonthOfYear=l.yearly.relative.recurrenceMonthOfYear))};this.save=function(){t.startDate=t.everyDay?null:t.startDate,t.endDate=t.everyDay?null:t.endDate,t.startTime=t.allDay?null:t.startTime,t.endTime=t.allDay?null:t.endTime,o()},this.recurrence=l,this.timeline=t}}]),function(e){e.module("risevision.common.components.timeline").directive("largerThanDate",[function(){return{require:"ngModel",link:function(e,r,n,t){e.$watchGroup(["timeline.startDate","timeline.endDate"],function(e){var r=e[0]&&new Date(e[0]),n=e[1]&&new Date(e[1]),l=!(r&&n&&r>n);t.$setValidity("largerThanDate",l)})}}}])}(angular),function(e){e.module("risevision.common.components.timeline").directive("datepickerLocaldate",["$parse",function(){return{restrict:"A",require:["ngModel"],link:function(e,r,n,t){var l=e.$eval(n.datepickerLocaldate),c=t[0],a=function(e){return e.toLocaleDateString("en-US")+" "+e.toLocaleTimeString("en-US")};c.$parsers.push(function(e){return e?(l?e.setMinutes(e.getMinutes()-e.getTimezoneOffset()):e=a(e),e):null}),c.$formatters.push(function(e){if(!e)return void 0;var r=new Date(e);return l&&r.setMinutes(r.getMinutes()+r.getTimezoneOffset()),r})}}}])}(angular),function(e){e.module("risevision.common.components.timeline").directive("weekDropdown",function(){return{restrict:"E",scope:{week:"="},templateUrl:"timeline/week-dropdown.html"}})}(angular),function(e){e.module("risevision.common.components.timeline").directive("timelineTextbox",["$modal",function(r){return{restrict:"E",scope:{useLocaldate:"=",timeDefined:"=",startDate:"=",endDate:"=",startTime:"=",endTime:"=",recurrenceType:"=",recurrenceFrequency:"=",recurrenceAbsolute:"=",recurrenceDayOfWeek:"=",recurrenceDayOfMonth:"=",recurrenceWeekOfMonth:"=",recurrenceMonthOfYear:"=",recurrenceDaysOfWeek:"="},templateUrl:"timeline/timeline-textbox.html",link:function(n){n.timeline={useLocaldate:n.useLocaldate,always:!n.timeDefined,startDate:n.startDate,endDate:n.endDate,startTime:n.startTime,endTime:n.endTime,recurrenceType:n.recurrenceType,recurrenceFrequency:n.recurrenceFrequency,recurrenceAbsolute:n.recurrenceAbsolute,recurrenceDayOfWeek:n.recurrenceDayOfWeek,recurrenceDayOfMonth:n.recurrenceDayOfMonth,recurrenceWeekOfMonth:n.recurrenceWeekOfMonth,recurrenceMonthOfYear:n.recurrenceMonthOfYear,recurrenceDaysOfWeek:n.recurrenceDaysOfWeek},n.$watch("timeline.always",function(e){n.timeDefined=!e}),n.openModal=function(){var t=r.open({templateUrl:"timeline/timeline-modal.html",controller:"timelineModal",resolve:{timeline:function(){return e.copy(n.timeline)}},size:"md",backdrop:"static"});t.result.then(function(e){n.timeline=e,n.startDate=e.startDate,n.endDate=e.endDate,n.startTime=e.startTime,n.endTime=e.endTime,n.recurrenceType=e.recurrenceType,n.recurrenceFrequency=e.recurrenceFrequency,n.recurrenceAbsolute=e.recurrenceAbsolute,n.recurrenceDayOfWeek=e.recurrenceDayOfWeek,n.recurrenceDayOfMonth=e.recurrenceDayOfMonth,n.recurrenceWeekOfMonth=e.recurrenceWeekOfMonth,n.recurrenceMonthOfYear=e.recurrenceMonthOfYear,n.recurrenceDaysOfWeek=e.recurrenceDaysOfWeek},function(){})}}}}])}(angular),function(e){e.module("risevision.common.components.timeline").directive("monthDropdown",function(){return{restrict:"E",scope:{month:"="},templateUrl:"timeline/month-dropdown.html"}})}(angular),function(e){e.module("risevision.common.components.timeline").directive("weekdayDropdown",function(){return{restrict:"E",scope:{weekday:"="},templateUrl:"timeline/weekday-dropdown.html"}})}(angular),function(e){e.module("risevision.common.components.timeline").controller("timelineModal",["$scope","$modalInstance","timeline","TimelineFactory",function(e,r,n,t){var l=new t(n);e.recurrence=l.recurrence,e.timeline=l.timeline,e.dateOptions={formatYear:"yy",startingDay:1,showWeeks:!1,showButtonBar:!1},e.today=new Date,e.datepickers={},e.openDatepicker=function(r,n){r.preventDefault(),r.stopPropagation(),e.datepickers[n]=!0},e.save=function(){l.save(),r.close(e.timeline)},e.close=function(){r.dismiss()}}])}(angular),function(e){try{e=angular.module("risevision.common.components.timeline")}catch(r){e=angular.module("risevision.common.components.timeline",[])}e.run(["$templateCache",function(e){e.put("timeline/month-dropdown.html",'<select class="form-control" ng-model="month" integer-parser=""><option value="0">January</option><option value="1">February</option><option value="2">March</option><option value="3">April</option><option value="4">May</option><option value="5">June</option><option value="6">July</option><option value="7">August</option><option value="8">September</option><option value="9">October</option><option value="10">November</option><option value="11">December</option></select>')}])}(),function(e){try{e=angular.module("risevision.common.components.timeline")}catch(r){e=angular.module("risevision.common.components.timeline",[])}e.run(["$templateCache",function(e){e.put("timeline/timeline-modal.html",'<div id="timelineModal"><div class="modal-header"><button type="button" class="close" ng-click="close()" aria-hidden="true"><i class="fa fa-times"></i></button><h3 class="modal-title">Edit Timeline</h3></div><div class="modal-body"><form role="form" name="timelineDetails" novalidate=""><div class="timeline"><div class="content-box-editable clickable"><div class="label label-tag"><span>Start 02-Jan-2014 End 21-Jan-2014 08:00AM to 05:30PM Weekly (Sun,Sat)</span></div></div><section><label class="control-label half-bottom" for="everyday"><input type="checkbox" ng-model="timeline.everyDay"> <strong>Every Day</strong></label><div class="row" ng-show="!timeline.everyDay"><div class="col-sm-4"><div class="form-group"><label class="control-label">Start Date</label><div class="input-group"><input type="text" id="startDate" name="startDate" class="form-control" datepicker-popup="dd-MMM-yyyy" ng-model="timeline.startDate" is-open="datepickers.startDate" min-date="today" datepicker-options="dateOptions" datepicker-localdate="{{timeline.useLocaldate}}" ng-required="!timeline.everyDay" close-text="Close"> <span class="input-group-btn"><button type="button" class="btn btn-default" ng-click="openDatepicker($event, \'startDate\')"><i class="fa fa-calendar"></i></button></span></div></div></div><div class="col-sm-4"><div class="form-group"><label class="control-label">End Date</label><div class="input-group"><input type="text" id="endDate" name="endDate" class="form-control" datepicker-popup="dd-MMM-yyyy" ng-model="timeline.endDate" is-open="datepickers.endDate" min-date="timeline.startDate" datepicker-options="dateOptions" datepicker-localdate="{{timeline.useLocaldate}}" larger-than-date="" close-text="Close"> <span class="input-group-btn"><button type="button" class="btn btn-default" ng-click="openDatepicker($event, \'endDate\')"><i class="fa fa-calendar"></i></button></span></div></div></div></div><p class="text-danger" ng-show="timelineDetails.startDate.$invalid">Start Date is a required field</p><p class="text-danger" ng-show="timelineDetails.endDate.$invalid">End Date must occur after Start Date</p></section><section><label class="control-label half-bottom"><input type="checkbox" ng-model="timeline.allDay"> <strong>All Day</strong></label><div class="row form-group" ng-hide="timeline.allDay"><div class="col-sm-4"><label class="control-label">Start Time</label><div class="time-picker"><timepicker id="startTime" ng-model="timeline.startTime" ng-change="changed()" hour-step="1" minute-step="15" show-meridian="true" datepicker-localdate="{{timeline.useLocaldate}}"></timepicker></div></div><div class="col-sm-4"><label class="control-label">End Time</label><div class="time-picker"><timepicker id="endTime" ng-model="timeline.endTime" ng-change="changed()" hour-step="1" minute-step="15" show-meridian="true" datepicker-localdate="{{timeline.useLocaldate}}"></timepicker></div></div></div></section><section><label class="control-label half-bottom" for="recurrence"><strong>Recurrence</strong></label><div class="form-group"><label for="Daily" class="add-right control-label"><input type="radio" ng-model="timeline.recurrenceType" value="Daily" id="Daily" name="recurrenceType"> Daily</label> <label for="Weekly" class="add-right control-label"><input type="radio" ng-model="timeline.recurrenceType" value="Weekly" id="Weekly" name="recurrenceType"> Weekly</label> <label for="Monthly" class="add-right control-label"><input type="radio" ng-model="timeline.recurrenceType" value="Monthly" id="Monthly" name="recurrenceType"> Monthly</label> <label for="Yearly" class="add-right control-label"><input type="radio" ng-model="timeline.recurrenceType" value="Yearly" id="Yearly" name="recurrenceType"> Yearly</label></div><div class="recurrence-option"><div ng-if="timeline.recurrenceType === \'Daily\'"><div class="form-group"><label class="control-label">Every</label> <input type="number" class="form-control input-short" name="dailyRecurrenceFrequency" ng-model="recurrence.daily.recurrenceFrequency" min="1" max="999" ng-required="timeline.recurrenceType === \'Daily\'"> <label class="control-label">Day(s)</label><p class="text-danger" ng-show="timelineDetails.dailyRecurrenceFrequency.$invalid">Daily Recurrence Frequency must be a number between 1 and 999</p></div></div><div ng-if="timeline.recurrenceType === \'Weekly\'"><div class="form-group"><label class="control-label">Every</label> <input type="number" class="form-control input-short" name="weeklyRecurrenceFrequency" ng-model="recurrence.weekly.recurrenceFrequency" min="1" max="999" ng-required="timeline.recurrenceType === \'Weekly\'"> <label class="control-label">Week(s)</label><p class="text-danger" ng-show="timelineDetails.weeklyRecurrenceFrequency.$invalid">Weekly Recurrence Frequency must be a number between 1 and 999</p></div><div class="form-group timelineWeekdays"><label class="control-label"><input type="checkbox" ng-model="recurrence.weekly.monday"> Monday</label> <label class="control-label"><input type="checkbox" ng-model="recurrence.weekly.tuesday"> Tuesday</label> <label class="control-label"><input type="checkbox" ng-model="recurrence.weekly.wednesday"> Wednesday</label> <label class="control-label"><input type="checkbox" ng-model="recurrence.weekly.thursday"> Thursday</label> <label class="control-label"><input type="checkbox" ng-model="recurrence.weekly.friday"> Friday</label> <label class="control-label"><input type="checkbox" ng-model="recurrence.weekly.saturday"> Saturday</label> <label class="control-label"><input type="checkbox" ng-model="recurrence.weekly.sunday"> Sunday</label></div></div><div ng-if="timeline.recurrenceType === \'Monthly\'"><div class="form-group"><label class="control-label"><input ng-model="recurrence.monthly.recurrenceAbsolute" ng-value="true" type="radio"> Day</label><fieldset ng-disabled="!recurrence.monthly.recurrenceAbsolute"><input type="number" class="form-control input-short" name="monthlyAbsoluteRecurrenceDayOfMonth" ng-model="recurrence.monthly.absolute.recurrenceDayOfMonth" min="1" max="31" ng-required="timeline.recurrenceType === \'Monthly\' && recurrence.monthly.recurrenceAbsolute"> <label class="control-label">of Every</label> <input type="number" class="form-control input-short" name="monthlyAbsoluteRecurrenceFrequency" ng-model="recurrence.monthly.absolute.recurrenceFrequency" min="1" max="999" ng-required="timeline.recurrenceType === \'Monthly\' && recurrence.monthly.recurrenceAbsolute"> <label class="control-label">Month(s)</label></fieldset><p class="text-danger" ng-show="timelineDetails.monthlyAbsoluteRecurrenceDayOfMonth.$invalid">Monthly Recurrence Day Of Month value must be between 1 and 31</p><p class="text-danger" ng-show="timelineDetails.monthlyAbsoluteRecurrenceFrequency.$invalid">Monthly Recurrence Frequency must be a number between 1 and 999</p></div><div class="form-group"><label class="control-label"><input ng-model="recurrence.monthly.recurrenceAbsolute" ng-value="false" type="radio"> The</label><fieldset ng-disabled="recurrence.monthly.recurrenceAbsolute"><week-dropdown week="recurrence.monthly.relative.recurrenceWeekOfMonth"></week-dropdown><weekday-dropdown weekday="recurrence.monthly.relative.recurrenceDayOfWeek"></weekday-dropdown><label class="control-label">of Every</label> <input type="number" class="form-control input-short" name="monthlyRelativeRecurrenceFrequency" ng-model="recurrence.monthly.relative.recurrenceFrequency" min="1" max="999" ng-required="timeline.recurrenceType === \'Monthly\' && !recurrence.monthly.recurrenceAbsolute" <label="">Month(s)</fieldset><p class="text-danger" ng-show="timelineDetails.monthlyRelativeRecurrenceFrequency.$invalid">Monthly Relative Recurrence Frequency must be a number between 1 and 999</p></div></div><div ng-if="timeline.recurrenceType === \'Yearly\'"><div class="form-group"><label class="control-label"><input type="radio" ng-model="recurrence.yearly.recurrenceAbsolute" ng-value="true"> Every</label><fieldset ng-disabled="!recurrence.yearly.recurrenceAbsolute"><month-dropdown month="recurrence.yearly.absolute.recurrenceMonthOfYear"></month-dropdown><input type="number" class="form-control input-short" name="yearlyAbsoluteRecurrenceDayOfMonth" ng-model="recurrence.yearly.absolute.recurrenceDayOfMonth" min="1" max="31" ng-required="timeline.recurrenceType === \'Yearly\' && recurrence.yearly.recurrenceAbsolute"></fieldset><p class="text-danger" ng-show="timelineDetails.yearlyAbsoluteRecurrenceDayOfMonth.$invalid">Yearly Recurrence Day Of Month value must be between 1 and 31</p></div><div class="form-group"><label class="control-label"><input type="radio" ng-model="recurrence.yearly.recurrenceAbsolute" ng-value="false"> The</label><fieldset ng-disabled="recurrence.yearly.recurrenceAbsolute"><week-dropdown week="recurrence.yearly.relative.recurrenceWeekOfMonth"></week-dropdown><weekday-dropdown weekday="recurrence.yearly.relative.recurrenceDayOfWeek"></weekday-dropdown><label class="control-label">of</label><month-dropdown month="recurrence.yearly.relative.recurrenceMonthOfYear"></month-dropdown></fieldset></div></div></div></section></div></form></div><div class="modal-footer"><button type="button" class="btn btn-primary btn-fixed-width" ng-click="save()" ng-disabled="timelineDetails.$invalid">Apply <i class="fa fa-white fa-check icon-right"></i></button> <button type="button" class="btn btn-default btn-fixed-width" ng-click="close()">Cancel <i class="fa fa-times icon-right"></i></button></div></div>')}])}(),function(e){try{e=angular.module("risevision.common.components.timeline")}catch(r){e=angular.module("risevision.common.components.timeline",[])}e.run(["$templateCache",function(e){e.put("timeline/timeline-textbox.html",'<label class="control-label control-label-secondary add-left"><input ng-model="timeline.always" type="checkbox"> Always</label><div id="timelineTextbox" class="content-box-editable remove-bottom clickable" ng-click="openModal()" ng-show="!timeline.always"><div class="label label-tag">{{timeline.label}}</div></div>')}])}(),function(e){try{e=angular.module("risevision.common.components.timeline")}catch(r){e=angular.module("risevision.common.components.timeline",[])}e.run(["$templateCache",function(e){e.put("timeline/week-dropdown.html",'<select class="form-control" ng-model="week" integer-parser=""><option value="0">First</option><option value="1">Second</option><option value="2">Third</option><option value="3">Fourth</option><option value="4">Last</option></select>')}])}(),function(e){try{e=angular.module("risevision.common.components.timeline")}catch(r){e=angular.module("risevision.common.components.timeline",[])}e.run(["$templateCache",function(e){e.put("timeline/weekday-dropdown.html",'<select class="form-control" ng-model="weekday" integer-parser=""><option value="0">Sunday</option><option value="1">Monday</option><option value="2">Tuesday</option><option value="3">Wednesday</option><option value="4">Thursday</option><option value="5">Friday</option><option value="6">Saturday</option></select>')}])}();